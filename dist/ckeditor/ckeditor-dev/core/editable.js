/*
 Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
(function(){function Z(a){var b=a.editor,c=a.data.path,d=c.blockLimit,f=a.data.selection,e=f.getRanges()[0],k;if(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller)if(f=aa(f,c))f.appendBogus(),k=CKEDITOR.env.ie;Q(b,c.block,d)&&e.collapsed&&!e.getCommonAncestor().isReadOnly()&&(c=e.clone(),c.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),d=new CKEDITOR.dom.walker(c),d.guard=function(a){return!G(a)||a.type==CKEDITOR.NODE_COMMENT||a.isReadOnly()},!d.checkForward()||c.checkStartOfBlock()&&c.checkEndOfBlock())&&
(b=e.fixBlock(!0,b.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p"),CKEDITOR.env.needsBrFiller||(b=b.getFirst(G))&&b.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(b.getText()).match(/^(?:&nbsp;|\xa0)$/)&&b.remove(),k=1,a.cancel());k&&e.select()}function aa(a,b){if(a.isFake)return 0;var c=b.block||b.blockLimit,d=c&&c.getLast(G);if(!(!c||!c.isBlockBoundary()||d&&d.type==CKEDITOR.NODE_ELEMENT&&d.isBlockBoundary()||c.is("pre")||c.getBogus()))return c}function ba(a){var b=a.data.getTarget();b.is("input")&&
(b=b.getAttribute("type"),"submit"!=b&&"reset"!=b||a.data.preventDefault())}function G(a){return H(a)&&N(a)}function ca(a,b){return function(c){var d=c.data.$.toElement||c.data.$.fromElement||c.data.$.relatedTarget;(d=d&&d.nodeType==CKEDITOR.NODE_ELEMENT?new CKEDITOR.dom.element(d):null)&&(b.equals(d)||b.contains(d))||a.call(this,c)}}function da(a){function b(a){return function(d,b){b&&d.type==CKEDITOR.NODE_ELEMENT&&d.is(f)&&(c=d);if(!(b||!G(d)||a&&J(d)))return!1}}var c,d=a.getRanges()[0];a=a.root;
var f={table:1,ul:1,ol:1,dl:1};if(d.startPath().contains(f)){var e=d.clone();e.collapse(1);e.setStartAt(a,CKEDITOR.POSITION_AFTER_START);a=new CKEDITOR.dom.walker(e);a.guard=b();a.checkBackward();if(c)return e=d.clone(),e.collapse(),e.setEndAt(c,CKEDITOR.POSITION_AFTER_END),a=new CKEDITOR.dom.walker(e),a.guard=b(!0),c=!1,a.checkForward(),c}return null}function Q(a,b,c){return!1!==a.config.autoParagraph&&a.activeEnterMode!=CKEDITOR.ENTER_BR&&(a.editable().equals(c)&&!b||b&&"true"==b.getAttribute("contenteditable"))}
function T(a){return a.activeEnterMode!=CKEDITOR.ENTER_BR&&!1!==a.config.autoParagraph?a.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p":!1}function U(a){var b=a.editor;b.getSelection().scrollIntoView();setTimeout(function(){b.fire("saveSnapshot")},0)}function V(a,b,c){var d=a.getCommonAncestor(b);for(b=a=c?b:a;(a=a.getParent())&&!d.equals(a)&&1==a.getChildCount();)b=a;b.remove()}var H,N,K,J,R,S,W,X,D,Y;CKEDITOR.editable=CKEDITOR.tools.createClass({base:CKEDITOR.dom.element,$:function(a,b){this.base(b.$||
b);this.editor=a;this.status="unloaded";this.hasFocus=!1;this.setup()},proto:{focus:function(){var a;if(CKEDITOR.env.webkit&&!this.hasFocus&&(a=this.editor._.previousActive||this.getDocument().getActive(),this.contains(a))){a.focus();return}CKEDITOR.env.edge&&14<CKEDITOR.env.version&&!this.hasFocus&&this.getDocument().equals(CKEDITOR.document)&&(this.editor._.previousScrollTop=this.$.scrollTop);try{if(!CKEDITOR.env.ie||CKEDITOR.env.edge&&14<CKEDITOR.env.version||!this.getDocument().equals(CKEDITOR.document))if(CKEDITOR.env.chrome){var b=
this.$.scrollTop;this.$.focus();this.$.scrollTop=b}else this.$.focus();else this.$.setActive()}catch(c){if(!CKEDITOR.env.ie)throw c;}CKEDITOR.env.safari&&!this.isInline()&&(a=CKEDITOR.document.getActive(),a.equals(this.getWindow().getFrame())||this.getWindow().focus())},on:function(a,b){var c=Array.prototype.slice.call(arguments,0);CKEDITOR.env.ie&&/^focus|blur$/.exec(a)&&(a="focus"==a?"focusin":"focusout",b=ca(b,this),c[0]=a,c[1]=b);return CKEDITOR.dom.element.prototype.on.apply(this,c)},attachListener:function(a){!this._.listeners&&
(this._.listeners=[]);var b=Array.prototype.slice.call(arguments,1),b=a.on.apply(a,b);this._.listeners.push(b);return b},clearListeners:function(){var a=this._.listeners;try{for(;a.length;)a.pop().removeListener()}catch(b){}},restoreAttrs:function(){var a=this._.attrChanges,b,c;for(c in a)a.hasOwnProperty(c)&&(b=a[c],null!==b?this.setAttribute(c,b):this.removeAttribute(c))},attachClass:function(a){var b=this.getCustomData("classes");this.hasClass(a)||(!b&&(b=[]),b.push(a),this.setCustomData("classes",
b),this.addClass(a))},changeAttr:function(a,b){var c=this.getAttribute(a);b!==c&&(!this._.attrChanges&&(this._.attrChanges={}),a in this._.attrChanges||(this._.attrChanges[a]=c),this.setAttribute(a,b))},insertText:function(a){this.editor.focus();this.insertHtml(this.transformPlainTextToHtml(a),"text")},transformPlainTextToHtml:function(a){var b=this.editor.getSelection().getStartElement().hasAscendant("pre",!0)?CKEDITOR.ENTER_BR:this.editor.activeEnterMode;return CKEDITOR.tools.transformPlainTextToHtml(a,
b)},insertHtml:function(a,b,c){var d=this.editor;d.focus();d.fire("saveSnapshot");c||(c=d.getSelection().getRanges()[0]);S(this,b||"html",a,c);c.select();U(this);this.editor.fire("afterInsertHtml",{})},insertHtmlIntoRange:function(a,b,c){S(this,c||"html",a,b);this.editor.fire("afterInsertHtml",{intoRange:b})},insertElement:function(a,b){var c=this.editor;c.focus();c.fire("saveSnapshot");var d=c.activeEnterMode,c=c.getSelection(),f=a.getName(),f=CKEDITOR.dtd.$block[f];b||(b=c.getRanges()[0]);this.insertElementIntoRange(a,
b)&&(b.moveToPosition(a,CKEDITOR.POSITION_AFTER_END),f&&((f=a.getNext(function(a){return G(a)&&!J(a)}))&&f.type==CKEDITOR.NODE_ELEMENT&&f.is(CKEDITOR.dtd.$block)?f.getDtd()["#"]?b.moveToElementEditStart(f):b.moveToElementEditEnd(a):f||d==CKEDITOR.ENTER_BR||(f=b.fixBlock(!0,d==CKEDITOR.ENTER_DIV?"div":"p"),b.moveToElementEditStart(f))));c.selectRanges([b]);U(this)},insertElementIntoSelection:function(a){this.insertElement(a)},insertElementIntoRange:function(a,b){var c=this.editor,d=c.config.enterMode,
f=a.getName(),e=CKEDITOR.dtd.$block[f];if(b.checkReadOnly())return!1;b.deleteContents(1);b.startContainer.type==CKEDITOR.NODE_ELEMENT&&(b.startContainer.is({tr:1,table:1,tbody:1,thead:1,tfoot:1})?W(b):b.startContainer.is(CKEDITOR.dtd.$list)&&X(b));var k,l;if(e)for(;(k=b.getCommonAncestor(0,1))&&(l=CKEDITOR.dtd[k.getName()])&&(!l||!l[f]);)k.getName()in CKEDITOR.dtd.span?b.splitElement(k):b.checkStartOfBlock()&&b.checkEndOfBlock()?(b.setStartBefore(k),b.collapse(!0),k.remove()):b.splitBlock(d==CKEDITOR.ENTER_DIV?
"div":"p",c.editable());b.insertNode(a);return!0},setData:function(a,b){b||(a=this.editor.dataProcessor.toHtml(a));this.setHtml(a);this.fixInitialSelection();"unloaded"==this.status&&(this.status="ready");this.editor.fire("dataReady")},getData:function(a){var b=this.getHtml();a||(b=this.editor.dataProcessor.toDataFormat(b));return b},setReadOnly:function(a){this.setAttribute("contenteditable",!a)},detach:function(){this.removeClass("cke_editable");this.status="detached";var a=this.editor;this._.detach();
delete a.document;delete a.window},isInline:function(){return this.getDocument().equals(CKEDITOR.document)},fixInitialSelection:function(){function a(){var a=c.getDocument().$,b=a.getSelection(),e;a:if(b.anchorNode&&b.anchorNode==c.$)e=!0;else{if(CKEDITOR.env.webkit&&(e=c.getDocument().getActive())&&e.equals(c)&&!b.anchorNode){e=!0;break a}e=void 0}e&&(e=new CKEDITOR.dom.range(c),e.moveToElementEditStart(c),a=a.createRange(),a.setStart(e.startContainer.$,e.startOffset),a.collapse(!0),b.removeAllRanges(),
b.addRange(a))}function b(){var a=c.getDocument().$,b=a.selection,e=c.getDocument().getActive();"None"==b.type&&e.equals(c)&&(b=new CKEDITOR.dom.range(c),a=a.body.createTextRange(),b.moveToElementEditStart(c),b=b.startContainer,b.type!=CKEDITOR.NODE_ELEMENT&&(b=b.getParent()),a.moveToElementText(b.$),a.collapse(!0),a.select())}var c=this;if(CKEDITOR.env.ie&&(9>CKEDITOR.env.version||CKEDITOR.env.quirks))this.hasFocus&&(this.focus(),b());else if(this.hasFocus)this.focus(),a();else this.once("focus",
function(){a()},null,null,-999)},getHtmlFromRange:function(a){if(a.collapsed)return new CKEDITOR.dom.documentFragment(a.document);a={doc:this.getDocument(),range:a.clone()};D.eol.detect(a,this);D.bogus.exclude(a);D.cell.shrink(a);a.fragment=a.range.cloneContents();D.tree.rebuild(a,this);D.eol.fix(a,this);return new CKEDITOR.dom.documentFragment(a.fragment.$)},extractHtmlFromRange:function(a,b){var c=Y,d={range:a,doc:a.document},f=this.getHtmlFromRange(a);if(a.collapsed)return a.optimize(),f;a.enlarge(CKEDITOR.ENLARGE_INLINE,
1);c.table.detectPurge(d);d.bookmark=a.createBookmark();delete d.range;var e=this.editor.createRange();e.moveToPosition(d.bookmark.startNode,CKEDITOR.POSITION_BEFORE_START);d.targetBookmark=e.createBookmark();c.list.detectMerge(d,this);c.table.detectRanges(d,this);c.block.detectMerge(d,this);d.tableContentsRanges?(c.table.deleteRanges(d),a.moveToBookmark(d.bookmark),d.range=a):(a.moveToBookmark(d.bookmark),d.range=a,a.extractContents(c.detectExtractMerge(d)));a.moveToBookmark(d.targetBookmark);a.optimize();
c.fixUneditableRangePosition(a);c.list.merge(d,this);c.table.purge(d,this);c.block.merge(d,this);if(b){c=a.startPath();if(d=a.checkStartOfBlock()&&a.checkEndOfBlock()&&c.block&&!a.root.equals(c.block)){a:{var d=c.block.getElementsByTag("span"),e=0,k;if(d)for(;k=d.getItem(e++);)if(!N(k)){d=!0;break a}d=!1}d=!d}d&&(a.moveToPosition(c.block,CKEDITOR.POSITION_BEFORE_START),c.block.remove())}else c.autoParagraph(this.editor,a),K(a.startContainer)&&a.startContainer.appendBogus();a.startContainer.mergeSiblings();
return f},setup:function(){var a=this.editor;this.attachListener(a,"beforeGetData",function(){var b=this.getData();this.is("textarea")||!1!==a.config.ignoreEmptyParagraph&&(b=b.replace(R,function(a,b){return b}));a.setData(b,null,1)},this);this.attachListener(a,"getSnapshot",function(a){a.data=this.getData(1)},this);this.attachListener(a,"afterSetData",function(){this.setData(a.getData(1))},this);this.attachListener(a,"loadSnapshot",function(a){this.setData(a.data,1)},this);this.attachListener(a,
"beforeFocus",function(){var b=a.getSelection();(b=b&&b.getNative())&&"Control"==b.type||this.focus()},this);this.attachListener(a,"insertHtml",function(a){this.insertHtml(a.data.dataValue,a.data.mode,a.data.range)},this);this.attachListener(a,"insertElement",function(a){this.insertElement(a.data)},this);this.attachListener(a,"insertText",function(a){this.insertText(a.data)},this);this.setReadOnly(a.readOnly);this.attachClass("cke_editable");a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?this.attachClass("cke_editable_inline"):
a.elementMode!=CKEDITOR.ELEMENT_MODE_REPLACE&&a.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO||this.attachClass("cke_editable_themed");this.attachClass("cke_contents_"+a.config.contentsLangDirection);a.keystrokeHandler.blockedKeystrokes[8]=+a.readOnly;a.keystrokeHandler.attach(this);this.on("blur",function(){this.hasFocus=!1},null,null,-1);this.on("focus",function(){this.hasFocus=!0},null,null,-1);if(CKEDITOR.env.webkit)this.on("scroll",function(){a._.previousScrollTop=a.editable().$.scrollTop},null,
null,-1);if(CKEDITOR.env.edge&&14<CKEDITOR.env.version){var b=function(){var d=a.editable();null!=a._.previousScrollTop&&d.getDocument().equals(CKEDITOR.document)&&(d.$.scrollTop=a._.previousScrollTop,a._.previousScrollTop=null,this.removeListener("scroll",b))};this.on("scroll",b)}a.focusManager.add(this);this.equals(CKEDITOR.document.getActive())&&(this.hasFocus=!0,a.once("contentDom",function(){a.focusManager.focus(this)},this));this.isInline()&&this.changeAttr("tabindex",a.tabIndex);if(!this.is("textarea")){a.document=
this.getDocument();a.window=this.getWindow();var c=a.document;this.changeAttr("spellcheck",!a.config.disableNativeSpellChecker);var d=a.config.contentsLangDirection;this.getDirection(1)!=d&&this.changeAttr("dir",d);var f=CKEDITOR.getCss();if(f){var d=c.getHead(),e=d.getCustomData("stylesheet");e?f!=e.getText()&&(CKEDITOR.env.ie&&9>CKEDITOR.env.version?e.$.styleSheet.cssText=f:e.setText(f)):(f=c.appendStyleText(f),f=new CKEDITOR.dom.element(f.ownerNode||f.owningElement),d.setCustomData("stylesheet",
f),f.data("cke-temp",1))}d=c.getCustomData("stylesheet_ref")||0;c.setCustomData("stylesheet_ref",d+1);this.setCustomData("cke_includeReadonly",!a.config.disableReadonlyStyling);this.attachListener(this,"click",function(a){a=a.data;var b=(new CKEDITOR.dom.elementPath(a.getTarget(),this)).contains("a");b&&2!=a.$.button&&b.isReadOnly()&&a.preventDefault()});var k={8:1,46:1};this.attachListener(a,"key",function(b){if(a.readOnly)return!0;var d=b.data.domEvent.getKey(),c;b=a.getSelection();if(0!==b.getRanges().length){if(d in
k){var f,e=b.getRanges()[0],h=e.startPath(),A,u,m,d=8==d;CKEDITOR.env.ie&&11>CKEDITOR.env.version&&(f=b.getSelectedElement())||(f=da(b))?(a.fire("saveSnapshot"),e.moveToPosition(f,CKEDITOR.POSITION_BEFORE_START),f.remove(),e.select(),a.fire("saveSnapshot"),c=1):e.collapsed&&((A=h.block)&&(m=A[d?"getPrevious":"getNext"](H))&&m.type==CKEDITOR.NODE_ELEMENT&&m.is("table")&&e[d?"checkStartOfBlock":"checkEndOfBlock"]()?(a.fire("saveSnapshot"),e[d?"checkEndOfBlock":"checkStartOfBlock"]()&&A.remove(),e["moveToElementEdit"+
(d?"End":"Start")](m),e.select(),a.fire("saveSnapshot"),c=1):h.blockLimit&&h.blockLimit.is("td")&&(u=h.blockLimit.getAscendant("table"))&&e.checkBoundaryOfElement(u,d?CKEDITOR.START:CKEDITOR.END)&&(m=u[d?"getPrevious":"getNext"](H))?(a.fire("saveSnapshot"),e["moveToElementEdit"+(d?"End":"Start")](m),e.checkStartOfBlock()&&e.checkEndOfBlock()?m.remove():e.select(),a.fire("saveSnapshot"),c=1):(u=h.contains(["td","th","caption"]))&&e.checkBoundaryOfElement(u,d?CKEDITOR.START:CKEDITOR.END)&&(c=1))}return!c}});
a.blockless&&CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller&&this.attachListener(this,"keyup",function(b){b.data.getKeystroke()in k&&!this.getFirst(G)&&(this.appendBogus(),b=a.createRange(),b.moveToPosition(this,CKEDITOR.POSITION_AFTER_START),b.select())});this.attachListener(this,"dblclick",function(b){if(a.readOnly)return!1;b={element:b.data.getTarget()};a.fire("doubleclick",b)});CKEDITOR.env.ie&&this.attachListener(this,"click",ba);CKEDITOR.env.ie&&!CKEDITOR.env.edge||this.attachListener(this,"mousedown",
function(b){var d=b.data.getTarget();d.is("img","hr","input","textarea","select")&&!d.isReadOnly()&&(a.getSelection().selectElement(d),d.is("input","textarea","select")&&b.data.preventDefault())});CKEDITOR.env.edge&&this.attachListener(this,"mouseup",function(b){(b=b.data.getTarget())&&b.is("img")&&a.getSelection().selectElement(b)});CKEDITOR.env.gecko&&this.attachListener(this,"mouseup",function(b){if(2==b.data.$.button&&(b=b.data.getTarget(),!b.getOuterHtml().replace(R,""))){var d=a.createRange();
d.moveToElementEditStart(b);d.select(!0)}});CKEDITOR.env.webkit&&(this.attachListener(this,"click",function(a){a.data.getTarget().is("input","select")&&a.data.preventDefault()}),this.attachListener(this,"mouseup",function(a){a.data.getTarget().is("input","textarea")&&a.data.preventDefault()}));CKEDITOR.env.webkit&&this.attachListener(a,"key",function(b){if(a.readOnly)return!0;var d=b.data.domEvent.getKey();if(d in k&&(b=a.getSelection(),0!==b.getRanges().length)){var d=8==d,c=b.getRanges()[0];b=c.startPath();
if(c.collapsed)a:{var e=b.block;if(e&&c[d?"checkStartOfBlock":"checkEndOfBlock"]()&&c.moveToClosestEditablePosition(e,!d)&&c.collapsed){if(c.startContainer.type==CKEDITOR.NODE_ELEMENT){var f=c.startContainer.getChild(c.startOffset-(d?1:0));if(f&&f.type==CKEDITOR.NODE_ELEMENT&&f.is("hr")){a.fire("saveSnapshot");f.remove();b=!0;break a}}c=c.startPath().block;if(!c||c&&c.contains(e))b=void 0;else{a.fire("saveSnapshot");var h;(h=(d?c:e).getBogus())&&h.remove();h=a.getSelection();f=h.createBookmarks();
(d?e:c).moveChildren(d?c:e,!1);b.lastElement.mergeSiblings();V(e,c,!d);h.selectBookmarks(f);b=!0}}else b=!1}else d=c,h=b.block,c=d.endPath().block,h&&c&&!h.equals(c)?(a.fire("saveSnapshot"),(e=h.getBogus())&&e.remove(),d.enlarge(CKEDITOR.ENLARGE_INLINE),d.deleteContents(),c.getParent()&&(c.moveChildren(h,!1),b.lastElement.mergeSiblings(),V(h,c,!0)),d=a.getSelection().getRanges()[0],d.collapse(1),d.optimize(),""===d.startContainer.getHtml()&&d.startContainer.appendBogus(),d.select(),b=!0):b=!1;if(!b)return;
a.getSelection().scrollIntoView();a.fire("saveSnapshot");return!1}},this,null,100)}}},_:{detach:function(){this.editor.setData(this.editor.getData(),0,1);this.clearListeners();this.restoreAttrs();var a;if(a=this.removeCustomData("classes"))for(;a.length;)this.removeClass(a.pop());if(!this.is("textarea")){a=this.getDocument();var b=a.getHead();if(b.getCustomData("stylesheet")){var c=a.getCustomData("stylesheet_ref");--c?a.setCustomData("stylesheet_ref",c):(a.removeCustomData("stylesheet_ref"),b.removeCustomData("stylesheet").remove())}}this.editor.fire("contentDomUnload");
delete this.editor}}});CKEDITOR.editor.prototype.editable=function(a){var b=this._.editable;if(b&&a)return 0;arguments.length&&(b=this._.editable=a?a instanceof CKEDITOR.editable?a:new CKEDITOR.editable(this,a):(b&&b.detach(),null));return b};CKEDITOR.on("instanceLoaded",function(a){var b=a.editor;b.on("insertElement",function(a){a=a.data;a.type==CKEDITOR.NODE_ELEMENT&&(a.is("input")||a.is("textarea"))&&("false"!=a.getAttribute("contentEditable")&&a.data("cke-editable",a.hasAttribute("contenteditable")?
"true":"1"),a.setAttribute("contentEditable",!1))});b.on("selectionChange",function(a){if(!b.readOnly){var d=b.getSelection();d&&!d.isLocked&&(d=b.checkDirty(),b.fire("lockSnapshot"),Z(a),b.fire("unlockSnapshot"),!d&&b.resetDirty())}})});CKEDITOR.on("instanceCreated",function(a){var b=a.editor;b.on("mode",function(){var a=b.editable();if(a&&a.isInline()){var d=b.title;a.changeAttr("role","textbox");a.changeAttr("aria-label",d);d&&a.changeAttr("title",d);var f=b.fire("ariaEditorHelpLabel",{}).label;
if(f&&(d=this.ui.space(this.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"top":"contents"))){var e=CKEDITOR.tools.getNextId(),f=CKEDITOR.dom.element.createFromHtml('\x3cspan id\x3d"'+e+'" class\x3d"cke_voice_label"\x3e'+f+"\x3c/span\x3e");d.append(f);a.changeAttr("aria-describedby",e)}}})});CKEDITOR.addCss(".cke_editable{cursor:text}.cke_editable img,.cke_editable input,.cke_editable textarea{cursor:default}");H=CKEDITOR.dom.walker.whitespaces(!0);N=CKEDITOR.dom.walker.bookmark(!1,!0);K=CKEDITOR.dom.walker.empty();
J=CKEDITOR.dom.walker.bogus();R=/(^|<body\b[^>]*>)\s*<(p|div|address|h\d|center|pre)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\2>)?\s*(?=$|<\/body>)/gi;S=function(){function a(a){return a.type==CKEDITOR.NODE_ELEMENT}function b(d,c){var e,f,k,g,n=[],r=c.range.startContainer;e=c.range.startPath();for(var r=l[r.getName()],p=0,w=d.getChildren(),B=w.count(),t=-1,q=-1,x=0,y=e.contains(l.$list);p<B;++p)e=w.getItem(p),a(e)?(k=e.getName(),y&&k in CKEDITOR.dtd.$list?n=n.concat(b(e,c)):(g=!!r[k],
"br"!=k||!e.data("cke-eol")||p&&p!=B-1||(x=(f=p?n[p-1].node:w.getItem(p+1))&&(!a(f)||!f.is("br")),f=f&&a(f)&&l.$block[f.getName()]),-1!=t||g||(t=p),g||(q=p),n.push({isElement:1,isLineBreak:x,isBlock:e.isBlockBoundary(),hasBlockSibling:f,node:e,name:k,allowed:g}),f=x=0)):n.push({isElement:0,node:e,allowed:1});-1<t&&(n[t].firstNotAllowed=1);-1<q&&(n[q].lastNotAllowed=1);return n}function c(b,d){var e=[],f=b.getChildren(),k=f.count(),g,n=0,r=l[d],p=!b.is(l.$inline)||b.is("br");for(p&&e.push(" ");n<k;n++)g=
f.getItem(n),a(g)&&!g.is(r)?e=e.concat(c(g,d)):e.push(g);p&&e.push(" ");return e}function d(b){return a(b.startContainer)&&b.startContainer.getChild(b.startOffset-1)}function f(b){return b&&a(b)&&(b.is(l.$removeEmpty)||b.is("a")&&!b.isBlockBoundary())}function e(b,d,c,f){var k=b.clone(),l,n;k.setEndAt(d,CKEDITOR.POSITION_BEFORE_END);(l=(new CKEDITOR.dom.walker(k)).next())&&a(l)&&g[l.getName()]&&(n=l.getPrevious())&&a(n)&&!n.getParent().equals(b.startContainer)&&c.contains(n)&&f.contains(l)&&l.isIdentical(n)&&
(l.moveChildren(n),l.remove(),e(b,d,c,f))}function k(b,d){function c(b,d){if(d.isBlock&&d.isElement&&!d.node.is("br")&&a(b)&&b.is("br"))return b.remove(),1}var e=d.endContainer.getChild(d.endOffset),f=d.endContainer.getChild(d.endOffset-1);e&&c(e,b[b.length-1]);f&&c(f,b[0])&&(d.setEnd(d.endContainer,d.endOffset-1),d.collapse())}var l=CKEDITOR.dtd,g={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,li:1,pre:1,dl:1,blockquote:1},r={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},w=CKEDITOR.tools.extend({},
l.$inline);delete w.br;return function(g,h,A,u){var m=g.editor,I=!1;"unfiltered_html"==h&&(h="html",I=!0);if(!u.checkReadOnly()){var n=(new CKEDITOR.dom.elementPath(u.startContainer,u.root)).blockLimit||u.root;g={type:h,dontFilter:I,editable:g,editor:m,range:u,blockLimit:n,mergeCandidates:[],zombies:[]};h=g.range;u=g.mergeCandidates;var v,p;"text"==g.type&&h.shrink(CKEDITOR.SHRINK_ELEMENT,!0,!1)&&(v=CKEDITOR.dom.element.createFromHtml("\x3cspan\x3e\x26nbsp;\x3c/span\x3e",h.document),h.insertNode(v),
h.setStartAfter(v));I=new CKEDITOR.dom.elementPath(h.startContainer);g.endPath=n=new CKEDITOR.dom.elementPath(h.endContainer);if(!h.collapsed){var m=n.block||n.blockLimit,D=h.getCommonAncestor();m&&!m.equals(D)&&!m.contains(D)&&h.checkEndOfBlock()&&g.zombies.push(m);h.deleteContents()}for(;(p=d(h))&&a(p)&&p.isBlockBoundary()&&I.contains(p);)h.moveToPosition(p,CKEDITOR.POSITION_BEFORE_END);e(h,g.blockLimit,I,n);v&&(h.setEndBefore(v),h.collapse(),v.remove());v=h.startPath();if(m=v.contains(f,!1,1))h.splitElement(m),
g.inlineStylesRoot=m,g.inlineStylesPeak=v.lastElement;v=h.createBookmark();(m=v.startNode.getPrevious(G))&&a(m)&&f(m)&&u.push(m);(m=v.startNode.getNext(G))&&a(m)&&f(m)&&u.push(m);for(m=v.startNode;(m=m.getParent())&&f(m);)u.push(m);h.moveToBookmark(v);if(v=A){v=g.range;if("text"==g.type&&g.inlineStylesRoot){p=g.inlineStylesPeak;h=p.getDocument().createText("{cke-peak}");for(u=g.inlineStylesRoot.getParent();!p.equals(u);)h=h.appendTo(p.clone()),p=p.getParent();A=h.getOuterHtml().split("{cke-peak}").join(A)}p=
g.blockLimit.getName();if(/^\s+|\s+$/.test(A)&&"span"in CKEDITOR.dtd[p]){var B='\x3cspan data-cke-marker\x3d"1"\x3e\x26nbsp;\x3c/span\x3e';A=B+A+B}A=g.editor.dataProcessor.toHtml(A,{context:null,fixForBody:!1,protectedWhitespaces:!!B,dontFilter:g.dontFilter,filter:g.editor.activeFilter,enterMode:g.editor.activeEnterMode});p=v.document.createElement("body");p.setHtml(A);B&&(p.getFirst().remove(),p.getLast().remove());if((B=v.startPath().block)&&(1!=B.getChildCount()||!B.getBogus()))a:{var t;if(1==
p.getChildCount()&&a(t=p.getFirst())&&t.is(r)&&!t.hasAttribute("contenteditable")){B=t.getElementsByTag("*");v=0;for(u=B.count();v<u;v++)if(h=B.getItem(v),!h.is(w))break a;t.moveChildren(t.getParent(1));t.remove()}}g.dataWrapper=p;v=A}if(v){t=g.range;v=t.document;var q;p=g.blockLimit;u=0;var x,B=[],y,F;A=m=0;var C,L;h=t.startContainer;var I=g.endPath.elements[0],M,n=I.getPosition(h),D=!!I.getCommonAncestor(h)&&n!=CKEDITOR.POSITION_IDENTICAL&&!(n&CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED);
h=b(g.dataWrapper,g);for(k(h,t);u<h.length;u++){n=h[u];if(q=n.isLineBreak){q=t;C=p;var E=void 0,O=void 0;n.hasBlockSibling?q=1:(E=q.startContainer.getAscendant(l.$block,1))&&E.is({div:1,p:1})?(O=E.getPosition(C),O==CKEDITOR.POSITION_IDENTICAL||O==CKEDITOR.POSITION_CONTAINS?q=0:(C=q.splitElement(E),q.moveToPosition(C,CKEDITOR.POSITION_AFTER_START),q=1)):q=0}if(q)A=0<u;else{q=t.startPath();!n.isBlock&&Q(g.editor,q.block,q.blockLimit)&&(F=T(g.editor))&&(F=v.createElement(F),F.appendBogus(),t.insertNode(F),
CKEDITOR.env.needsBrFiller&&(x=F.getBogus())&&x.remove(),t.moveToPosition(F,CKEDITOR.POSITION_BEFORE_END));if((q=t.startPath().block)&&!q.equals(y)){if(x=q.getBogus())x.remove(),B.push(q);y=q}n.firstNotAllowed&&(m=1);if(m&&n.isElement){q=t.startContainer;for(C=null;q&&!l[q.getName()][n.name];){if(q.equals(p)){q=null;break}C=q;q=q.getParent()}if(q)C&&(L=t.splitElement(C),g.zombies.push(L),g.zombies.push(C));else{C=p.getName();M=!u;q=u==h.length-1;C=c(n.node,C);for(var E=[],O=C.length,H=0,J=void 0,
K=0,N=-1;H<O;H++)J=C[H]," "==J?(K||M&&!H||(E.push(new CKEDITOR.dom.text(" ")),N=E.length),K=1):(E.push(J),K=0);q&&N==E.length&&E.pop();M=E}}if(M){for(;q=M.pop();)t.insertNode(q);M=0}else t.insertNode(n.node);n.lastNotAllowed&&u<h.length-1&&((L=D?I:L)&&t.setEndAt(L,CKEDITOR.POSITION_AFTER_START),m=0);t.collapse()}}1!=h.length?x=!1:(x=h[0],x=x.isElement&&"false"==x.node.getAttribute("contenteditable"));x&&(A=!0,q=h[0].node,t.setStartAt(q,CKEDITOR.POSITION_BEFORE_START),t.setEndAt(q,CKEDITOR.POSITION_AFTER_END));
g.dontMoveCaret=A;g.bogusNeededBlocks=B}x=g.range;var P;L=g.bogusNeededBlocks;for(M=x.createBookmark();y=g.zombies.pop();)y.getParent()&&(F=x.clone(),F.moveToElementEditStart(y),F.removeEmptyBlocksAtEnd());if(L)for(;y=L.pop();)CKEDITOR.env.needsBrFiller?y.appendBogus():y.append(x.document.createText(" "));for(;y=g.mergeCandidates.pop();)y.mergeSiblings();x.moveToBookmark(M);if(!g.dontMoveCaret){for(y=d(x);y&&a(y)&&!y.is(l.$empty);){if(y.isBlockBoundary())x.moveToPosition(y,CKEDITOR.POSITION_BEFORE_END);
else{if(f(y)&&y.getHtml().match(/(\s|&nbsp;)$/g)){P=null;break}P=x.clone();P.moveToPosition(y,CKEDITOR.POSITION_BEFORE_END)}y=y.getLast(G)}P&&x.moveToRange(P)}}}}();W=function(){function a(a){a=new CKEDITOR.dom.walker(a);a.guard=function(a,b){if(b)return!1;if(a.type==CKEDITOR.NODE_ELEMENT)return a.is(CKEDITOR.dtd.$tableContent)};a.evaluator=function(a){return a.type==CKEDITOR.NODE_ELEMENT};return a}function b(a,b,c){b=a.getDocument().createElement(b);a.append(b,c);return b}function c(a){var b=a.count(),
c;for(b;0<b--;)c=a.getItem(b),CKEDITOR.tools.trim(c.getHtml())||(c.appendBogus(),CKEDITOR.env.ie&&9>CKEDITOR.env.version&&c.getChildCount()&&c.getFirst().remove())}return function(d){var f=d.startContainer,e=f.getAscendant("table",1),k=!1;c(e.getElementsByTag("td"));c(e.getElementsByTag("th"));e=d.clone();e.setStart(f,0);e=a(e).lastBackward();e||(e=d.clone(),e.setEndAt(f,CKEDITOR.POSITION_BEFORE_END),e=a(e).lastForward(),k=!0);e||(e=f);e.is("table")?(d.setStartAt(e,CKEDITOR.POSITION_BEFORE_START),
d.collapse(!0),e.remove()):(e.is({tbody:1,thead:1,tfoot:1})&&(e=b(e,"tr",k)),e.is("tr")&&(e=b(e,e.getParent().is("thead")?"th":"td",k)),(f=e.getBogus())&&f.remove(),d.moveToPosition(e,k?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END))}}();X=function(){function a(a){a=new CKEDITOR.dom.walker(a);a.guard=function(a,b){if(b)return!1;if(a.type==CKEDITOR.NODE_ELEMENT)return a.is(CKEDITOR.dtd.$list)||a.is(CKEDITOR.dtd.$listItem)};a.evaluator=function(a){return a.type==CKEDITOR.NODE_ELEMENT&&
a.is(CKEDITOR.dtd.$listItem)};return a}return function(b){var c=b.startContainer,d=!1,f;f=b.clone();f.setStart(c,0);f=a(f).lastBackward();f||(f=b.clone(),f.setEndAt(c,CKEDITOR.POSITION_BEFORE_END),f=a(f).lastForward(),d=!0);f||(f=c);f.is(CKEDITOR.dtd.$list)?(b.setStartAt(f,CKEDITOR.POSITION_BEFORE_START),b.collapse(!0),f.remove()):((c=f.getBogus())&&c.remove(),b.moveToPosition(f,d?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END),b.select())}}();D={eol:{detect:function(a,b){var c=a.range,
d=c.clone(),f=c.clone(),e=new CKEDITOR.dom.elementPath(c.startContainer,b),k=new CKEDITOR.dom.elementPath(c.endContainer,b);d.collapse(1);f.collapse();e.block&&d.checkBoundaryOfElement(e.block,CKEDITOR.END)&&(c.setStartAfter(e.block),a.prependEolBr=1);k.block&&f.checkBoundaryOfElement(k.block,CKEDITOR.START)&&(c.setEndBefore(k.block),a.appendEolBr=1)},fix:function(a,b){var c=b.getDocument(),d;a.appendEolBr&&(d=this.createEolBr(c),a.fragment.append(d));!a.prependEolBr||d&&!d.getPrevious()||a.fragment.append(this.createEolBr(c),
1)},createEolBr:function(a){return a.createElement("br",{attributes:{"data-cke-eol":1}})}},bogus:{exclude:function(a){var b=a.range.getBoundaryNodes(),c=b.startNode,b=b.endNode;!b||!J(b)||c&&c.equals(b)||a.range.setEndBefore(b)}},tree:{rebuild:function(a,b){var c=a.range,d=c.getCommonAncestor(),f=new CKEDITOR.dom.elementPath(d,b),e=new CKEDITOR.dom.elementPath(c.startContainer,b),c=new CKEDITOR.dom.elementPath(c.endContainer,b),k;d.type==CKEDITOR.NODE_TEXT&&(d=d.getParent());if(f.blockLimit.is({tr:1,
table:1})){var l=f.contains("table").getParent();k=function(a){return!a.equals(l)}}else if(f.block&&f.block.is(CKEDITOR.dtd.$listItem)&&(e=e.contains(CKEDITOR.dtd.$list),c=c.contains(CKEDITOR.dtd.$list),!e.equals(c))){var g=f.contains(CKEDITOR.dtd.$list).getParent();k=function(a){return!a.equals(g)}}k||(k=function(a){return!a.equals(f.block)&&!a.equals(f.blockLimit)});this.rebuildFragment(a,b,d,k)},rebuildFragment:function(a,b,c,d){for(var f;c&&!c.equals(b)&&d(c);)f=c.clone(0,1),a.fragment.appendTo(f),
a.fragment=f,c=c.getParent()}},cell:{shrink:function(a){a=a.range;var b=a.startContainer,c=a.endContainer,d=a.startOffset,f=a.endOffset;b.type==CKEDITOR.NODE_ELEMENT&&b.equals(c)&&b.is("tr")&&++d==f&&a.shrink(CKEDITOR.SHRINK_TEXT)}}};Y=function(){function a(a,b){var c=a.getParent();if(c.is(CKEDITOR.dtd.$inline))a[b?"insertBefore":"insertAfter"](c)}function b(b,c,e){a(c);a(e,1);for(var k;k=e.getNext();)k.insertAfter(c),c=k;K(b)&&b.remove()}function c(a,b){var c=new CKEDITOR.dom.range(a);c.setStartAfter(b.startNode);
c.setEndBefore(b.endNode);return c}return{list:{detectMerge:function(a,b){var e=c(b,a.bookmark),k=e.startPath(),l=e.endPath(),g=k.contains(CKEDITOR.dtd.$list),r=l.contains(CKEDITOR.dtd.$list);a.mergeList=g&&r&&g.getParent().equals(r.getParent())&&!g.equals(r);a.mergeListItems=k.block&&l.block&&k.block.is(CKEDITOR.dtd.$listItem)&&l.block.is(CKEDITOR.dtd.$listItem);if(a.mergeList||a.mergeListItems)e=e.clone(),e.setStartBefore(a.bookmark.startNode),e.setEndAfter(a.bookmark.endNode),a.mergeListBookmark=
e.createBookmark()},merge:function(a,c){if(a.mergeListBookmark){var e=a.mergeListBookmark.startNode,k=a.mergeListBookmark.endNode,l=new CKEDITOR.dom.elementPath(e,c),g=new CKEDITOR.dom.elementPath(k,c);if(a.mergeList){var r=l.contains(CKEDITOR.dtd.$list),w=g.contains(CKEDITOR.dtd.$list);r.equals(w)||(w.moveChildren(r),w.remove())}a.mergeListItems&&(l=l.contains(CKEDITOR.dtd.$listItem),g=g.contains(CKEDITOR.dtd.$listItem),l.equals(g)||b(g,e,k));e.remove();k.remove()}}},block:{detectMerge:function(a,
b){if(!a.tableContentsRanges&&!a.mergeListBookmark){var c=new CKEDITOR.dom.range(b);c.setStartBefore(a.bookmark.startNode);c.setEndAfter(a.bookmark.endNode);a.mergeBlockBookmark=c.createBookmark()}},merge:function(a,c){if(a.mergeBlockBookmark&&!a.purgeTableBookmark){var e=a.mergeBlockBookmark.startNode,k=a.mergeBlockBookmark.endNode,l=new CKEDITOR.dom.elementPath(e,c),g=new CKEDITOR.dom.elementPath(k,c),l=l.block,g=g.block;l&&g&&!l.equals(g)&&b(g,e,k);e.remove();k.remove()}}},table:function(){function a(c){var d=
[],g,r=new CKEDITOR.dom.walker(c),w=c.startPath().contains(e),z=c.endPath().contains(e),h={};r.guard=function(a,r){if(a.type==CKEDITOR.NODE_ELEMENT){var m="visited_"+(r?"out":"in");if(a.getCustomData(m))return;CKEDITOR.dom.element.setMarker(h,a,m,1)}if(r&&w&&a.equals(w))g=c.clone(),g.setEndAt(w,CKEDITOR.POSITION_BEFORE_END),d.push(g);else if(!r&&z&&a.equals(z))g=c.clone(),g.setStartAt(z,CKEDITOR.POSITION_AFTER_START),d.push(g);else{if(m=!r)m=a.type==CKEDITOR.NODE_ELEMENT&&a.is(e)&&(!w||b(a,w))&&(!z||
b(a,z));m&&(g=c.clone(),g.selectNodeContents(a),d.push(g))}};r.lastForward();CKEDITOR.dom.element.clearAllMarkers(h);return d}function b(a,c){var d=CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED,e=a.getPosition(c);return e===CKEDITOR.POSITION_IDENTICAL?!1:0===(e&d)}var e={td:1,th:1,caption:1};return{detectPurge:function(a){var b=a.range,c=b.clone();c.enlarge(CKEDITOR.ENLARGE_ELEMENT);var c=new CKEDITOR.dom.walker(c),d=0;c.evaluator=function(a){a.type==CKEDITOR.NODE_ELEMENT&&a.is(e)&&++d};
c.checkForward();if(1<d){var c=b.startPath().contains("table"),f=b.endPath().contains("table");c&&f&&b.checkBoundaryOfElement(c,CKEDITOR.START)&&b.checkBoundaryOfElement(f,CKEDITOR.END)&&(b=a.range.clone(),b.setStartBefore(c),b.setEndAfter(f),a.purgeTableBookmark=b.createBookmark())}},detectRanges:function(k,l){var g=c(l,k.bookmark),r=g.clone(),w,z,h=g.getCommonAncestor();h.is(CKEDITOR.dtd.$tableContent)&&!h.is(e)&&(h=h.getAscendant("table",!0));z=h;h=new CKEDITOR.dom.elementPath(g.startContainer,
z);z=new CKEDITOR.dom.elementPath(g.endContainer,z);h=h.contains("table");z=z.contains("table");if(h||z)h&&z&&b(h,z)?(k.tableSurroundingRange=r,r.setStartAt(h,CKEDITOR.POSITION_AFTER_END),r.setEndAt(z,CKEDITOR.POSITION_BEFORE_START),r=g.clone(),r.setEndAt(h,CKEDITOR.POSITION_AFTER_END),w=g.clone(),w.setStartAt(z,CKEDITOR.POSITION_BEFORE_START),w=a(r).concat(a(w))):h?z||(k.tableSurroundingRange=r,r.setStartAt(h,CKEDITOR.POSITION_AFTER_END),g.setEndAt(h,CKEDITOR.POSITION_AFTER_END)):(k.tableSurroundingRange=
r,r.setEndAt(z,CKEDITOR.POSITION_BEFORE_START),g.setStartAt(z,CKEDITOR.POSITION_AFTER_START)),k.tableContentsRanges=w?w:a(g)},deleteRanges:function(a){for(var b;b=a.tableContentsRanges.pop();)b.extractContents(),K(b.startContainer)&&b.startContainer.appendBogus();a.tableSurroundingRange&&a.tableSurroundingRange.extractContents()},purge:function(a){if(a.purgeTableBookmark){var b=a.doc,c=a.range.clone(),b=b.createElement("p");b.insertBefore(a.purgeTableBookmark.startNode);c.moveToBookmark(a.purgeTableBookmark);
c.deleteContents();a.range.moveToPosition(b,CKEDITOR.POSITION_AFTER_START)}}}}(),detectExtractMerge:function(a){return!(a.range.startPath().contains(CKEDITOR.dtd.$listItem)&&a.range.endPath().contains(CKEDITOR.dtd.$listItem))},fixUneditableRangePosition:function(a){a.startContainer.getDtd()["#"]||a.moveToClosestEditablePosition(null,!0)},autoParagraph:function(a,b){var c=b.startPath(),k;Q(a,c.block,c.blockLimit)&&(k=T(a))&&(k=b.document.createElement(k),k.appendBogus(),b.insertNode(k),b.moveToPosition(k,
CKEDITOR.POSITION_AFTER_START))}}}()})();