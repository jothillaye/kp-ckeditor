/*
 Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
CKEDITOR.STYLE_BLOCK=1;CKEDITOR.STYLE_INLINE=2;CKEDITOR.STYLE_OBJECT=3;
(function(){function l(a,d){for(var b,c;(a=a.getParent())&&!a.equals(d);)if(a.getAttribute("data-nostyle"))b=a;else if(!c){var f=a.getAttribute("contentEditable");"false"==f?b=a:"true"==f&&(c=1)}return b}function q(a,d,b,c){return(a.getPosition(d)|c)==c&&(!b.childRule||b.childRule(a))}function k(a){var d=a.document;if(a.collapsed)d=J(this,d),a.insertNode(d),a.moveToPosition(d,CKEDITOR.POSITION_BEFORE_END);else{var b=this.element,c=this._.definition,f,e=c.ignoreReadonly,g=e||c.includeReadonly;null==
g&&(g=a.root.getCustomData("cke_includeReadonly"));var h=CKEDITOR.dtd[b];h||(f=!0,h=CKEDITOR.dtd.span);a.enlarge(CKEDITOR.ENLARGE_INLINE,1);a.trim();var n=a.createBookmark(),A=n.startNode,F=n.endNode,m=A,t;if(!e){var u=a.getCommonAncestor(),e=l(A,u),u=l(F,u);e&&(m=e.getNextSourceNode(!0));u&&(F=u)}for(m.getPosition(F)==CKEDITOR.POSITION_FOLLOWING&&(m=0);m;){e=!1;if(m.equals(F))m=null,e=!0;else{var p=m.type==CKEDITOR.NODE_ELEMENT?m.getName():null,u=p&&"false"==m.getAttribute("contentEditable"),y=p&&
m.getAttribute("data-nostyle");if(p&&m.data("cke-bookmark")){m=m.getNextSourceNode(!0);continue}if(u&&g&&CKEDITOR.dtd.$block[p])for(var G=m,w=U(G),x=void 0,r=w.length,v=0,G=r&&new CKEDITOR.dom.range(G.getDocument());v<r;++v){var x=w[v],E=CKEDITOR.filter.instances[x.data("cke-filter")];if(E?E.check(this):1)G.selectNodeContents(x),k.call(this,G)}w=p?!h[p]||y?0:u&&!g?0:q(m,F,c,K):1;if(w)if(x=m.getParent(),w=c,r=b,v=f,!x||!(x.getDtd()||CKEDITOR.dtd.span)[r]&&!v||w.parentRule&&!w.parentRule(x))e=!0;else{if(t||
p&&CKEDITOR.dtd.$removeEmpty[p]&&(m.getPosition(F)|K)!=K||(t=a.clone(),t.setStartBefore(m)),p=m.type,p==CKEDITOR.NODE_TEXT||u||p==CKEDITOR.NODE_ELEMENT&&!m.getChildCount()){for(var p=m,B;(e=!p.getNext(V))&&(B=p.getParent(),h[B.getName()])&&q(B,A,c,W);)p=B;t.setEndAfter(p)}}else e=!0;m=m.getNextSourceNode(y||u)}if(e&&t&&!t.collapsed){for(var e=J(this,d),u=e.hasAttributes(),y=t.getCommonAncestor(),p={},w={},x={},r={},D,z,C;e&&y;){if(y.getName()==b){for(D in c.attributes)!r[D]&&(C=y.getAttribute(z))&&
(e.getAttribute(D)==C?w[D]=1:r[D]=1);for(z in c.styles)!x[z]&&(C=y.getStyle(z))&&(e.getStyle(z)==C?p[z]=1:x[z]=1)}y=y.getParent()}for(D in w)e.removeAttribute(D);for(z in p)e.removeStyle(z);u&&!e.hasAttributes()&&(e=null);e?(t.extractContents().appendTo(e),t.insertNode(e),O.call(this,e),e.mergeSiblings(),CKEDITOR.env.ie||e.$.normalize()):(e=new CKEDITOR.dom.element("span"),t.extractContents().appendTo(e),t.insertNode(e),O.call(this,e),e.remove(!0));t=null}}a.moveToBookmark(n);a.shrink(CKEDITOR.SHRINK_TEXT);
a.shrink(CKEDITOR.NODE_ELEMENT,!0)}}function A(a){function d(){for(var a=new CKEDITOR.dom.elementPath(c.getParent()),b=new CKEDITOR.dom.elementPath(k.getParent()),d=null,f=null,e=0;e<a.elements.length;e++){var g=a.elements[e];if(g==a.block||g==a.blockLimit)break;m.checkElementRemovable(g,!0)&&(d=g)}for(e=0;e<b.elements.length;e++){g=b.elements[e];if(g==b.block||g==b.blockLimit)break;m.checkElementRemovable(g,!0)&&(f=g)}f&&k.breakParent(f);d&&c.breakParent(d)}a.enlarge(CKEDITOR.ENLARGE_INLINE,1);var b=
a.createBookmark(),c=b.startNode,f=this._.definition.alwaysRemoveElement;if(a.collapsed){for(var e=new CKEDITOR.dom.elementPath(c.getParent(),a.root),g,h=0,n;h<e.elements.length&&(n=e.elements[h])&&n!=e.block&&n!=e.blockLimit;h++)if(this.checkElementRemovable(n)){var l;!f&&a.collapsed&&(a.checkBoundaryOfElement(n,CKEDITOR.END)||(l=a.checkBoundaryOfElement(n,CKEDITOR.START)))?(g=n,g.match=l?"start":"end"):(n.mergeSiblings(),n.is(this.element)?E.call(this,n):B(n,v(this)[n.getName()]))}if(g){f=c;for(h=
0;;h++){n=e.elements[h];if(n.equals(g))break;else if(n.match)continue;else n=n.clone();n.append(f);f=n}f["start"==g.match?"insertBefore":"insertAfter"](g)}}else{var k=b.endNode,m=this;d();for(e=c;!e.equals(k);)g=e.getNextSourceNode(),e.type==CKEDITOR.NODE_ELEMENT&&this.checkElementRemovable(e)&&(e.getName()==this.element?E.call(this,e):B(e,v(this)[e.getName()]),g.type==CKEDITOR.NODE_ELEMENT&&g.contains(c)&&(d(),g=c.getNext())),e=g}a.moveToBookmark(b);a.shrink(CKEDITOR.NODE_ELEMENT,!0)}function U(a){var d=
[];a.forEach(function(a){if("true"==a.getAttribute("contenteditable"))return d.push(a),!1},CKEDITOR.NODE_ELEMENT,!0);return d}function C(a){var d=a.getEnclosedNode()||a.getCommonAncestor(!1,!0);(a=(new CKEDITOR.dom.elementPath(d,a.root)).contains(this.element,1))&&!a.isReadOnly()&&L(a,this)}function M(a){var d=a.getCommonAncestor(!0,!0);if(a=(new CKEDITOR.dom.elementPath(d,a.root)).contains(this.element,1)){var d=this._.definition,b=d.attributes;if(b)for(var c in b)a.removeAttribute(c,b[c]);if(d.styles)for(var f in d.styles)d.styles.hasOwnProperty(f)&&
a.removeStyle(f)}}function X(a){var d=a.createBookmark(!0),b=a.createIterator();b.enforceRealBlocks=!0;this._.enterMode&&(b.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR);for(var c,f=a.document,e;c=b.getNextParagraph();)!c.isReadOnly()&&(b.activeFilter?b.activeFilter.check(this):1)&&(e=J(this,f,c),P(c,e));a.moveToBookmark(d)}function Y(a){var d=a.createBookmark(1),b=a.createIterator();b.enforceRealBlocks=!0;b.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR;for(var c,f;c=b.getNextParagraph();)this.checkElementRemovable(c)&&
(c.is("pre")?((f=this._.enterMode==CKEDITOR.ENTER_BR?null:a.document.createElement(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))&&c.copyAttributes(f),P(c,f)):E.call(this,c));a.moveToBookmark(d)}function P(a,d){var b=!d;b&&(d=a.getDocument().createElement("div"),a.copyAttributes(d));var c=d&&d.is("pre"),f=a.is("pre"),e=!c&&f;if(c&&!f){f=d;(e=a.getBogus())&&e.remove();e=a.getHtml();e=r(e,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");e=e.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");e=e.replace(/([ \t\n\r]+|&nbsp;)/g,
" ");e=e.replace(/<br\b[^>]*>/gi,"\n");if(CKEDITOR.env.ie){var g=a.getDocument().createElement("div");g.append(f);f.$.outerHTML="\x3cpre\x3e"+e+"\x3c/pre\x3e";f.copyAttributes(g.getFirst());f=g.getFirst().remove()}else f.setHtml(e);d=f}else e?d=Z(b?[a.getHtml()]:aa(a),d):a.moveChildren(d);d.replace(a);if(c){var b=d,h;(h=b.getPrevious(N))&&h.type==CKEDITOR.NODE_ELEMENT&&h.is("pre")&&(c=r(h.getHtml(),/\n$/,"")+"\n\n"+r(b.getHtml(),/^\n/,""),CKEDITOR.env.ie?b.$.outerHTML="\x3cpre\x3e"+c+"\x3c/pre\x3e":
b.setHtml(c),h.remove())}else b&&H(d)}function aa(a){var d=[];r(a.getOuterHtml(),/(\S\s*)\n(?:\s|(<span[^>]+data-cke-bookmark.*?\/span>))*\n(?!$)/gi,function(a,c,d){return c+"\x3c/pre\x3e"+d+"\x3cpre\x3e"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(a,c){d.push(c)});return d}function r(a,d,b){var c="",f="";a=a.replace(/(^<span[^>]+data-cke-bookmark.*?\/span>)|(<span[^>]+data-cke-bookmark.*?\/span>$)/gi,function(a,b,d){b&&(c=b);d&&(f=d);return""});return c+a.replace(d,b)+f}function Z(a,d){var b;
1<a.length&&(b=new CKEDITOR.dom.documentFragment(d.getDocument()));for(var c=0;c<a.length;c++){var f=a[c],f=f.replace(/(\r\n|\r)/g,"\n"),f=r(f,/^[ \t]*\n/,""),f=r(f,/\n$/,""),f=r(f,/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"\x26nbsp;":b?" "+CKEDITOR.tools.repeat("\x26nbsp;",a.length-1):CKEDITOR.tools.repeat("\x26nbsp;",a.length-1)+" "}),f=f.replace(/\n/g,"\x3cbr\x3e"),f=f.replace(/[ \t]{2,}/g,function(a){return CKEDITOR.tools.repeat("\x26nbsp;",a.length-1)+" "});if(b){var e=d.clone();e.setHtml(f);
b.append(e)}else d.setHtml(f)}return b||d}function E(a,d){var b=this._.definition,c=b.attributes,b=b.styles,f=v(this)[a.getName()],e=CKEDITOR.tools.isEmpty(c)&&CKEDITOR.tools.isEmpty(b),g;for(g in c)if("class"!=g&&!this._.definition.fullMatch||a.getAttribute(g)==Q(g,c[g]))d&&"data-"==g.slice(0,5)||(e=a.hasAttribute(g),a.removeAttribute(g));for(var h in b)this._.definition.fullMatch&&a.getStyle(h)!=Q(h,b[h],!0)||(e=e||!!a.getStyle(h),a.removeStyle(h));B(a,f,R[a.getName()]);e&&(this._.definition.alwaysRemoveElement?
H(a,1):!CKEDITOR.dtd.$block[a.getName()]||this._.enterMode==CKEDITOR.ENTER_BR&&!a.hasAttributes()?H(a):a.renameNode(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))}function O(a){for(var d=v(this),b=a.getElementsByTag(this.element),c,f=b.count();0<=--f;)c=b.getItem(f),c.isReadOnly()||E.call(this,c,!0);for(var e in d)if(e!=this.element)for(b=a.getElementsByTag(e),f=b.count()-1;0<=f;f--)c=b.getItem(f),c.isReadOnly()||B(c,d[e])}function B(a,d,b){if(d=d&&d.attributes)for(var c=0;c<d.length;c++){var f=d[c][0],
e;if(e=a.getAttribute(f)){var g=d[c][1];(null===g||g.test&&g.test(e)||"string"==typeof g&&e==g)&&a.removeAttribute(f)}}b||H(a)}function H(a,d){if(!a.hasAttributes()||d)if(CKEDITOR.dtd.$block[a.getName()]){var b=a.getPrevious(N),c=a.getNext(N);!b||b.type!=CKEDITOR.NODE_TEXT&&b.isBlockBoundary({br:1})||a.append("br",1);!c||c.type!=CKEDITOR.NODE_TEXT&&c.isBlockBoundary({br:1})||a.append("br");a.remove(!0)}else b=a.getFirst(),c=a.getLast(),a.remove(!0),b&&(b.type==CKEDITOR.NODE_ELEMENT&&b.mergeSiblings(),
c&&!b.equals(c)&&c.type==CKEDITOR.NODE_ELEMENT&&c.mergeSiblings())}function J(a,d,b){var c;c=a.element;"*"==c&&(c="span");c=new CKEDITOR.dom.element(c,d);b&&b.copyAttributes(c);c=L(c,a);d.getCustomData("doc_processing_style")&&c.hasAttribute("id")?c.removeAttribute("id"):d.setCustomData("doc_processing_style",1);return c}function L(a,d){var b=d._.definition,c=b.attributes,b=CKEDITOR.style.getStyleText(b);if(c)for(var f in c)a.setAttribute(f,c[f]);b&&a.setAttribute("style",b);return a}function S(a,
d){for(var b in a)a[b]=a[b].replace(ba,function(a,b){return d[b]})}function v(a){if(a._.overrides)return a._.overrides;var d=a._.overrides={},b=a._.definition.overrides;if(b){CKEDITOR.tools.isArray(b)||(b=[b]);for(var c=0;c<b.length;c++){var f=b[c],e,g;"string"==typeof f?e=f.toLowerCase():(e=f.element?f.element.toLowerCase():a.element,g=f.attributes);f=d[e]||(d[e]={});if(g){var f=f.attributes=f.attributes||[],h;for(h in g)f.push([h.toLowerCase(),g[h]])}}}return d}function Q(a,d,b){var c=new CKEDITOR.dom.element("span");
c[b?"setStyle":"setAttribute"](a,d);return c[b?"getStyle":"getAttribute"](a)}function ca(a,d){function b(a,b){return"font-family"==b.toLowerCase()?a.replace(/["']/g,""):a}"string"==typeof a&&(a=CKEDITOR.tools.parseCssText(a));"string"==typeof d&&(d=CKEDITOR.tools.parseCssText(d,!0));for(var c in a)if(!(c in d)||b(d[c],c)!=b(a[c],c)&&"inherit"!=a[c]&&"inherit"!=d[c])return!1;return!0}function I(a,d,b){var c=a.document,f=a.getRanges();d=d?this.removeFromRange:this.applyToRange;var e,g;if(a.isFake&&
a.isInTable())for(e=[],g=0;g<f.length;g++)e.push(f[g].clone());for(var h=f.createIterator();g=h.getNextRange();)d.call(this,g,b);a.selectRanges(e||f);c.removeCustomData("doc_processing_style")}var R={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,section:1,header:1,footer:1,nav:1,article:1,aside:1,figure:1,dialog:1,hgroup:1,time:1,meter:1,menu:1,command:1,keygen:1,output:1,progress:1,details:1,datagrid:1,datalist:1},da={a:1,blockquote:1,embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,
tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1,audio:1,video:1},T=/\s*(?:;\s*|$)/,ba=/#\((.+?)\)/g,V=CKEDITOR.dom.walker.bookmark(0,1),N=CKEDITOR.dom.walker.whitespaces(1);CKEDITOR.style=function(a,d){if("string"==typeof a.type)return new CKEDITOR.style.customHandlers[a.type](a);var b=a.attributes;b&&b.style&&(a.styles=CKEDITOR.tools.extend({},a.styles,CKEDITOR.tools.parseCssText(b.style)),delete b.style);d&&(a=CKEDITOR.tools.clone(a),S(a.attributes,d),S(a.styles,d));b=this.element=a.element?"string"==typeof a.element?
a.element.toLowerCase():a.element:"*";this.type=a.type||(R[b]?CKEDITOR.STYLE_BLOCK:da[b]?CKEDITOR.STYLE_OBJECT:CKEDITOR.STYLE_INLINE);"object"==typeof this.element&&(this.type=CKEDITOR.STYLE_OBJECT);this._={definition:a}};CKEDITOR.style.prototype={apply:function(a){if(a instanceof CKEDITOR.dom.document)return I.call(this,a.getSelection());if(this.checkApplicable(a.elementPath(),a)){var d=this._.enterMode;d||(this._.enterMode=a.activeEnterMode);I.call(this,a.getSelection(),0,a);this._.enterMode=d}},
remove:function(a){if(a instanceof CKEDITOR.dom.document)return I.call(this,a.getSelection(),1);if(this.checkApplicable(a.elementPath(),a)){var d=this._.enterMode;d||(this._.enterMode=a.activeEnterMode);I.call(this,a.getSelection(),1,a);this._.enterMode=d}},applyToRange:function(a){this.applyToRange=this.type==CKEDITOR.STYLE_INLINE?k:this.type==CKEDITOR.STYLE_BLOCK?X:this.type==CKEDITOR.STYLE_OBJECT?C:null;return this.applyToRange(a)},removeFromRange:function(a){this.removeFromRange=this.type==CKEDITOR.STYLE_INLINE?
A:this.type==CKEDITOR.STYLE_BLOCK?Y:this.type==CKEDITOR.STYLE_OBJECT?M:null;return this.removeFromRange(a)},applyToObject:function(a){L(a,this)},checkActive:function(a,d){switch(this.type){case CKEDITOR.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,!0,d);case CKEDITOR.STYLE_OBJECT:case CKEDITOR.STYLE_INLINE:for(var b=a.elements,c=0,f;c<b.length;c++)if(f=b[c],this.type!=CKEDITOR.STYLE_INLINE||f!=a.block&&f!=a.blockLimit){if(this.type==CKEDITOR.STYLE_OBJECT){var e=f.getName();
if(!("string"==typeof this.element?e==this.element:e in this.element))continue}if(this.checkElementRemovable(f,!0,d))return!0}}return!1},checkApplicable:function(a,d,b){d&&d instanceof CKEDITOR.filter&&(b=d);if(b&&!b.check(this))return!1;switch(this.type){case CKEDITOR.STYLE_OBJECT:return!!a.contains(this.element);case CKEDITOR.STYLE_BLOCK:return!!a.blockLimit.getDtd()[this.element]}return!0},checkElementMatch:function(a,d){var b=this._.definition;if(!a||!b.ignoreReadonly&&a.isReadOnly())return!1;
var c=a.getName();if("string"==typeof this.element?c==this.element:c in this.element){if(!d&&!a.hasAttributes())return!0;if(c=b._AC)b=c;else{var c={},f=0,e=b.attributes;if(e)for(var g in e)f++,c[g]=e[g];if(g=CKEDITOR.style.getStyleText(b))c.style||f++,c.style=g;c._length=f;b=b._AC=c}if(b._length){for(var h in b)if("_length"!=h)if(c=a.getAttribute(h)||"","style"==h?ca(b[h],c):b[h]==c){if(!d)return!0}else if(d)return!1;if(d)return!0}else return!0}return!1},checkElementRemovable:function(a,d,b){if(this.checkElementMatch(a,
d,b))return!0;if(d=v(this)[a.getName()]){var c;if(!(d=d.attributes))return!0;for(b=0;b<d.length;b++)if(c=d[b][0],c=a.getAttribute(c)){var f=d[b][1];if(null===f)return!0;if("string"==typeof f){if(c==f)return!0}else if(f.test(c))return!0}}return!1},buildPreview:function(a){var d=this._.definition,b=[],c=d.element;"bdo"==c&&(c="span");var b=["\x3c",c],f=d.attributes;if(f)for(var e in f)b.push(" ",e,'\x3d"',f[e],'"');(f=CKEDITOR.style.getStyleText(d))&&b.push(' style\x3d"',f,'"');b.push("\x3e",a||d.name,
"\x3c/",c,"\x3e");return b.join("")},getDefinition:function(){return this._.definition}};CKEDITOR.style.getStyleText=function(a){var d=a._ST;if(d)return d;var d=a.styles,b=a.attributes&&a.attributes.style||"",c="";b.length&&(b=b.replace(T,";"));for(var f in d){var e=d[f],g=(f+":"+e).replace(T,";");"inherit"==e?c+=g:b+=g}b.length&&(b=CKEDITOR.tools.normalizeCssText(b,!0));return a._ST=b+c};CKEDITOR.style.customHandlers={};CKEDITOR.style.addCustomHandler=function(a){var d=function(a){this._={definition:a};
this.setup&&this.setup(a)};d.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.style.prototype),{assignedTo:CKEDITOR.STYLE_OBJECT},a,!0);return this.customHandlers[a.type]=d};var K=CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED,W=CKEDITOR.POSITION_FOLLOWING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED})();
CKEDITOR.styleCommand=function(l,q){this.requiredContent=this.allowedContent=this.style=l;CKEDITOR.tools.extend(this,q,!0)};CKEDITOR.styleCommand.prototype.exec=function(l){l.focus();this.state==CKEDITOR.TRISTATE_OFF?l.applyStyle(this.style):this.state==CKEDITOR.TRISTATE_ON&&l.removeStyle(this.style)};CKEDITOR.stylesSet=new CKEDITOR.resourceManager("","stylesSet");CKEDITOR.addStylesSet=CKEDITOR.tools.bind(CKEDITOR.stylesSet.add,CKEDITOR.stylesSet);
CKEDITOR.loadStylesSet=function(l,q,k){CKEDITOR.stylesSet.addExternal(l,q,"");CKEDITOR.stylesSet.load(l,k)};
CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{attachStyleStateChange:function(l,q){var k=this._.styleStateChangeCallbacks;k||(k=this._.styleStateChangeCallbacks=[],this.on("selectionChange",function(l){for(var q=0;q<k.length;q++){var C=k[q],M=C.style.checkActive(l.data.path,this)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF;C.fn.call(this,M)}}));k.push({style:l,fn:q})},applyStyle:function(l){l.apply(this)},removeStyle:function(l){l.remove(this)},getStylesSet:function(l){if(this._.stylesDefinitions)l(this._.stylesDefinitions);
else{var q=this,k=q.config.stylesCombo_stylesSet||q.config.stylesSet;if(!1===k)l(null);else if(k instanceof Array)q._.stylesDefinitions=k,l(k);else{k||(k="default");var k=k.split(":"),A=k[0];CKEDITOR.stylesSet.addExternal(A,k[1]?k.slice(1).join(":"):CKEDITOR.getUrl("styles.js"),"");CKEDITOR.stylesSet.load(A,function(k){q._.stylesDefinitions=k[A];l(q._.stylesDefinitions)})}}}});