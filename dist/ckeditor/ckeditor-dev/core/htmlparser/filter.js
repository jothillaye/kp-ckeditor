/*
 Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
(function(){function h(){this.rules=[]}function k(b,a,c,d){var e,f;for(e in a)(f=b[e])||(f=b[e]=new h),f.add(a[e],c,d)}CKEDITOR.htmlParser.filter=CKEDITOR.tools.createClass({$:function(b){this.id=CKEDITOR.tools.getNextNumber();this.elementNameRules=new h;this.attributeNameRules=new h;this.elementsRules={};this.attributesRules={};this.textRules=new h;this.commentRules=new h;this.rootRules=new h;b&&this.addRules(b,10)},proto:{addRules:function(b,a){var c;"number"==typeof a?c=a:a&&"priority"in a&&(c=
a.priority);"number"!=typeof c&&(c=10);"object"!=typeof a&&(a={});b.elementNames&&this.elementNameRules.addMany(b.elementNames,c,a);b.attributeNames&&this.attributeNameRules.addMany(b.attributeNames,c,a);b.elements&&k(this.elementsRules,b.elements,c,a);b.attributes&&k(this.attributesRules,b.attributes,c,a);b.text&&this.textRules.add(b.text,c,a);b.comment&&this.commentRules.add(b.comment,c,a);b.root&&this.rootRules.add(b.root,c,a)},applyTo:function(b){b.filter(this)},onElementName:function(b,a){return this.elementNameRules.execOnName(b,
a)},onAttributeName:function(b,a){return this.attributeNameRules.execOnName(b,a)},onText:function(b,a,c){return this.textRules.exec(b,a,c)},onComment:function(b,a,c){return this.commentRules.exec(b,a,c)},onRoot:function(b,a){return this.rootRules.exec(b,a)},onElement:function(b,a){for(var c=[this.elementsRules["^"],this.elementsRules[a.name],this.elementsRules.$],d,e=0;3>e;e++)if(d=c[e]){d=d.exec(b,a,this);if(!1===d)return null;if(d&&d!=a)return this.onNode(b,d);if(a.parent&&!a.name)break}return a},
onNode:function(b,a){var c=a.type;return c==CKEDITOR.NODE_ELEMENT?this.onElement(b,a):c==CKEDITOR.NODE_TEXT?new CKEDITOR.htmlParser.text(this.onText(b,a.value)):c==CKEDITOR.NODE_COMMENT?new CKEDITOR.htmlParser.comment(this.onComment(b,a.value)):null},onAttribute:function(b,a,c,d){return(c=this.attributesRules[c])?c.exec(b,d,a,this):d}}});CKEDITOR.htmlParser.filterRulesGroup=h;h.prototype={add:function(b,a,c){this.rules.splice(this.findIndex(a),0,{value:b,priority:a,options:c})},addMany:function(b,
a,c){for(var d=[this.findIndex(a),0],e=0,f=b.length;e<f;e++)d.push({value:b[e],priority:a,options:c});this.rules.splice.apply(this.rules,d)},findIndex:function(b){for(var a=this.rules,c=a.length-1;0<=c&&b<a[c].priority;)c--;return c+1},exec:function(b,a){var c=a instanceof CKEDITOR.htmlParser.node||a instanceof CKEDITOR.htmlParser.fragment,d=Array.prototype.slice.call(arguments,1),e=this.rules,f=e.length,h,k,g,l;for(l=0;l<f;l++)if(c&&(h=a.type,k=a.name),g=e[l],!(b.nonEditable&&!g.options.applyToAll||
b.nestedEditable&&g.options.excludeNestedEditable)){g=g.value.apply(null,d);if(!1===g||c&&g&&(g.name!=k||g.type!=h))return g;null!=g&&(d[0]=a=g)}return a},execOnName:function(b,a){for(var c=0,d=this.rules,e=d.length,f;a&&c<e;c++)f=d[c],b.nonEditable&&!f.options.applyToAll||b.nestedEditable&&f.options.excludeNestedEditable||(a=a.replace(f.value[0],f.value[1]));return a}}})();