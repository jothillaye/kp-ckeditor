/*
 Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
(function(){function H(a,b,c,d,e){var f,g;a=[];for(f in b){g=b[f];g="boolean"==typeof g?{}:"function"==typeof g?{match:g}:y(g);"$"!=f.charAt(0)&&(g.elements=f);c&&(g.featureName=c.toLowerCase());var h=g;h.elements=B(h.elements,/\s+/)||null;h.propertiesOnly=h.propertiesOnly||!0===h.elements;var k=/\s*,\s*/,m=void 0;for(m in I){h[m]=B(h[m],k)||null;var l=h,n=z[m],u=B(h[z[m]],k),t=h[m],w=[],p=!0,r=void 0;u?p=!1:u={};for(r in t)"!"==r.charAt(0)&&(r=r.slice(1),w.push(r),u[r]=!0,p=!1);for(;r=w.pop();)t[r]=
t["!"+r],delete t["!"+r];l[n]=(p?!1:u)||null}h.match=h.match||null;d.push(g);a.push(g)}b=e.elements;e=e.generic;var v;c=0;for(d=a.length;c<d;++c){f=y(a[c]);g=!0===f.classes||!0===f.styles||!0===f.attributes;h=f;m=n=k=void 0;for(k in I)h[k]=X(h[k]);l=!0;for(m in z){k=z[m];n=h[k];u=[];t=void 0;for(t in n)-1<t.indexOf("*")?u.push(new RegExp("^"+t.replace(/\*/g,".*")+"$")):u.push(t);n=u;n.length&&(h[k]=n,l=!1)}h.nothingRequired=l;h.noProperties=!(h.attributes||h.classes||h.styles);if(!0===f.elements||
null===f.elements)e[g?"unshift":"push"](f);else for(v in h=f.elements,delete f.elements,h)if(b[v])b[v][g?"unshift":"push"](f);else b[v]=[f]}}function J(a,b,c,d){if(!a.match||a.match(b))if(d||Y(a,b))if(a.propertiesOnly||(c.valid=!0),c.allAttributes||(c.allAttributes=K(a.attributes,b.attributes,c.validAttributes)),c.allStyles||(c.allStyles=K(a.styles,b.styles,c.validStyles)),!c.allClasses){a=a.classes;b=b.classes;d=c.validClasses;if(a)if(!0===a)a=!0;else{for(var e=0,f=b.length,g;e<f;++e)g=b[e],d[g]||
(d[g]=a(g));a=!1}else a=!1;c.allClasses=a}}function K(a,b,c){if(!a)return!1;if(!0===a)return!0;for(var d in b)c[d]||(c[d]=a(d));return!1}function L(a,b,c){if(!a.match||a.match(b)){if(a.noProperties)return!1;c.hadInvalidAttribute=M(a.attributes,b.attributes)||c.hadInvalidAttribute;c.hadInvalidStyle=M(a.styles,b.styles)||c.hadInvalidStyle;a=a.classes;b=b.classes;if(a){for(var d=!1,e=!0===a,f=b.length;f--;)if(e||a(b[f]))b.splice(f,1),d=!0;a=d}else a=!1;c.hadInvalidClass=a||c.hadInvalidClass}}function M(a,
b){if(!a)return!1;var c=!1,d=!0===a,e;for(e in b)if(d||a(e))delete b[e],c=!0;return c}function N(a,b,c){if(a.disabled||a.customConfig&&!c||!b)return!1;a._.cachedChecks={};return!0}function B(a,b){if(!a)return!1;if(!0===a)return a;if("string"==typeof a)return a=C(a),"*"==a?!0:CKEDITOR.tools.convertArrayToObject(a.split(b));if(CKEDITOR.tools.isArray(a))return a.length?CKEDITOR.tools.convertArrayToObject(a):!1;var c={},d=0,e;for(e in a)c[e]=a[e],d++;return d?c:!1}function Y(a,b){if(a.nothingRequired)return!0;
var c,d,e,f;if(e=a.requiredClasses)for(f=b.classes,c=0;c<e.length;++c)if(d=e[c],"string"==typeof d){if(-1==CKEDITOR.tools.indexOf(f,d))return!1}else if(!CKEDITOR.tools.checkIfAnyArrayItemMatches(f,d))return!1;return O(b.styles,a.requiredStyles)&&O(b.attributes,a.requiredAttributes)}function O(a,b){if(!b)return!0;for(var c=0,d;c<b.length;++c)if(d=b[c],"string"==typeof d){if(!(d in a))return!1}else if(!CKEDITOR.tools.checkIfAnyObjectPropertyMatches(a,d))return!1;return!0}function P(a){if(!a)return{};
a=a.split(/\s*,\s*/).sort();for(var b={};a.length;)b[a.shift()]="cke-test";return b}function D(a){var b,c,d,e,f={},g=1;for(a=C(a);b=a.match(Z);)(c=b[2])?(d=E(c,"styles"),e=E(c,"attrs"),c=E(c,"classes")):d=e=c=null,f["$"+g++]={elements:b[1],classes:c,styles:d,attributes:e},a=a.slice(b[0].length);return f}function E(a,b){var c=a.match(aa[b]);return c?C(c[1]):null}function Q(a){var b=a.styleBackup=a.attributes.style,c=a.classBackup=a.attributes["class"];a.styles||(a.styles=CKEDITOR.tools.parseCssText(b||
"",1));a.classes||(a.classes=c?c.split(/\s+/):[])}function F(a,b,c,d){var e=0,f;d.toHtml&&(b.name=b.name.replace(ba,"$1"));if(d.doCallbacks&&a.elementCallbacks){a:{f=a.elementCallbacks;for(var g=0,h=f.length,k;g<h;++g)if(k=f[g](b)){f=k;break a}f=void 0}if(f)return f}if(d.doTransform&&(f=a._.transformations[b.name])){Q(b);for(g=0;g<f.length;++g)R(a,b,f[g]);S(b)}if(d.doFilter){a:{g=b.name;h=a._;a=h.allowedRules.elements[g];f=h.allowedRules.generic;g=h.disallowedRules.elements[g];h=h.disallowedRules.generic;
k=d.skipRequired;var m={valid:!1,validAttributes:{},validClasses:{},validStyles:{},allAttributes:!1,allClasses:!1,allStyles:!1,hadInvalidAttribute:!1,hadInvalidClass:!1,hadInvalidStyle:!1},l,n;if(a||f){Q(b);if(g)for(l=0,n=g.length;l<n;++l)if(!1===L(g[l],b,m)){a=null;break a}if(h)for(l=0,n=h.length;l<n;++l)L(h[l],b,m);if(a)for(l=0,n=a.length;l<n;++l)J(a[l],b,m,k);if(f)for(l=0,n=f.length;l<n;++l)J(f[l],b,m,k);a=m}else a=null}if(!a||!a.valid)return c.push(b),1;n=a.validAttributes;var u=a.validStyles;
f=a.validClasses;var g=b.attributes,t=b.styles,h=b.classes;k=b.classBackup;var w=b.styleBackup,p,r,v=[],m=[],q=/^data-cke-/;l=!1;delete g.style;delete g["class"];delete b.classBackup;delete b.styleBackup;if(!a.allAttributes)for(p in g)n[p]||(q.test(p)?p==(r=p.replace(/^data-cke-saved-/,""))||n[r]||(delete g[p],l=!0):(delete g[p],l=!0));if(!a.allStyles||a.hadInvalidStyle){for(p in t)a.allStyles||u[p]?v.push(p+":"+t[p]):l=!0;v.length&&(g.style=v.sort().join("; "))}else w&&(g.style=w);if(!a.allClasses||
a.hadInvalidClass){for(p=0;p<h.length;++p)(a.allClasses||f[h[p]])&&m.push(h[p]);m.length&&(g["class"]=m.sort().join(" "));k&&m.length<k.split(/\s+/).length&&(l=!0)}else k&&(g["class"]=k);l&&(e=1);if(!d.skipFinalValidation&&!T(b))return c.push(b),1}d.toHtml&&(b.name=b.name.replace(ca,"cke:$1"));return e}function da(a){var b=[],c;for(c in a)-1<c.indexOf("*")&&b.push(c.replace(/\*/g,".*"));return b.length?new RegExp("^(?:"+b.join("|")+")$"):null}function S(a){var b=a.attributes,c;delete b.style;delete b["class"];
if(c=CKEDITOR.tools.writeCssText(a.styles,!0))b.style=c;a.classes.length&&(b["class"]=a.classes.sort().join(" "))}function T(a){switch(a.name){case "a":if(!(a.children.length||a.attributes.name||a.attributes.id))return!1;break;case "img":if(!a.attributes.src)return!1}return!0}function X(a){if(!a)return!1;if(!0===a)return!0;var b=da(a);return function(c){return c in a||b&&c.match(b)}}function G(){return new CKEDITOR.htmlParser.element("br")}function U(a){return a.type==CKEDITOR.NODE_ELEMENT&&("br"==
a.name||q.$block[a.name])}function x(a,b,c){var d=a.name;if(q.$empty[d]||!a.children.length)"hr"==d&&"br"==b?a.replaceWith(G()):(a.parent&&c.push({check:"it",el:a.parent}),a.remove());else if(q.$block[d]||"tr"==d)if("br"==b)a.previous&&!U(a.previous)&&(b=G(),b.insertBefore(a)),a.next&&!U(a.next)&&(b=G(),b.insertAfter(a)),a.replaceWithChildren();else{var d=a.children,e;b:{e=q[b];for(var f=0,g=d.length,h;f<g;++f)if(h=d[f],h.type==CKEDITOR.NODE_ELEMENT&&!e[h.name]){e=!1;break b}e=!0}if(e)a.name=b,a.attributes=
{},c.push({check:"parent-down",el:a});else{e=a.parent;for(var f=e.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||"body"==e.name,k,m,g=d.length;0<g;)h=d[--g],f&&(h.type==CKEDITOR.NODE_TEXT||h.type==CKEDITOR.NODE_ELEMENT&&q.$inline[h.name])?(k||(k=new CKEDITOR.htmlParser.element(b),k.insertAfter(a),c.push({check:"parent-down",el:k})),k.add(h,0)):(k=null,m=q[e.name]||q.span,h.insertAfter(a),e.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||h.type!=CKEDITOR.NODE_ELEMENT||m[h.name]||c.push({check:"el-up",el:h}));a.remove()}}else d in
{style:1,script:1}?a.remove():(a.parent&&c.push({check:"it",el:a.parent}),a.replaceWithChildren())}function R(a,b,c){var d,e;for(d=0;d<c.length;++d)if(e=c[d],!(e.check&&!a.check(e.check,!1)||e.left&&!e.left(b))){e.right(b,V);break}}function W(a,b){var c=b.getDefinition(),d=c.attributes,e=c.styles,f,g,h,k;if(a.name!=c.element)return!1;for(f in d)if("class"==f)for(c=d[f].split(/\s+/),h=a.classes.join("|");k=c.pop();){if(-1==h.indexOf(k))return!1}else if(a.attributes[f]!=d[f])return!1;for(g in e)if(a.styles[g]!=
e[g])return!1;return!0}function ea(a,b){var c,d;"string"==typeof a?c=a:a instanceof CKEDITOR.style?d=a:(c=a[0],d=a[1]);return[{element:c,left:d,right:function(a,c){c.transform(a,b)}}]}function fa(a){return function(b){return W(b,a)}}function ga(a){return function(b,c){c[a](b)}}var q=CKEDITOR.dtd,y=CKEDITOR.tools.copy,C=CKEDITOR.tools.trim,A=["","p","br","div"];CKEDITOR.FILTER_SKIP_TREE=2;CKEDITOR.filter=function(a){this.allowedContent=[];this.disallowedContent=[];this.elementCallbacks=null;this.disabled=
!1;this.editor=null;this.id=CKEDITOR.tools.getNextNumber();this._={allowedRules:{elements:{},generic:[]},disallowedRules:{elements:{},generic:[]},transformations:{},cachedTests:{},cachedChecks:{}};CKEDITOR.filter.instances[this.id]=this;if(a instanceof CKEDITOR.editor){a=this.editor=a;this.customConfig=!0;var b=a.config.allowedContent;!0===b?this.disabled=!0:(b||(this.customConfig=!1),this.allow(b,"config",1),this.allow(a.config.extraAllowedContent,"extra",1),this.allow(A[a.enterMode]+" "+A[a.shiftEnterMode],
"default",1),this.disallow(a.config.disallowedContent))}else this.customConfig=!1,this.allow(a,"default",1)};CKEDITOR.filter.instances={};CKEDITOR.filter.prototype={allow:function(a,b,c){if(!N(this,a,c))return!1;var d,e;if("string"==typeof a)a=D(a);else if(a instanceof CKEDITOR.style){if(a.toAllowedContentRules)return this.allow(a.toAllowedContentRules(this.editor),b,c);d=a.getDefinition();a={};c=d.attributes;a[d.element]=d={styles:d.styles,requiredStyles:d.styles&&CKEDITOR.tools.objectKeys(d.styles)};
c&&(c=y(c),d.classes=c["class"]?c["class"].split(/\s+/):null,d.requiredClasses=d.classes,delete c["class"],d.attributes=c,d.requiredAttributes=c&&CKEDITOR.tools.objectKeys(c))}else if(CKEDITOR.tools.isArray(a)){for(d=0;d<a.length;++d)e=this.allow(a[d],b,c);return e}H(this,a,b,this.allowedContent,this._.allowedRules);return!0},applyTo:function(a,b,c,d){if(this.disabled)return!1;var e=this,f=[],g=this.editor&&this.editor.config.protectedSource,h,k=!1,m={doFilter:!c,doTransform:!0,doCallbacks:!0,toHtml:b};
a.forEach(function(a){if(a.type==CKEDITOR.NODE_ELEMENT){if("off"==a.attributes["data-cke-filter"])return!1;if(!b||"span"!=a.name||!~CKEDITOR.tools.objectKeys(a.attributes).join("|").indexOf("data-cke-"))if(h=F(e,a,f,m),h&1)k=!0;else if(h&2)return!1}else if(a.type==CKEDITOR.NODE_COMMENT&&a.value.match(/^\{cke_protected\}(?!\{C\})/)){var c;a:{var d=decodeURIComponent(a.value.replace(/^\{cke_protected\}/,""));c=[];var l,n,q;if(g)for(n=0;n<g.length;++n)if((q=d.match(g[n]))&&q[0].length==d.length){c=!0;
break a}d=CKEDITOR.htmlParser.fragment.fromHtml(d);1==d.children.length&&(l=d.children[0]).type==CKEDITOR.NODE_ELEMENT&&F(e,l,c,m);c=!c.length}c||f.push(a)}},null,!0);f.length&&(k=!0);var l;a=[];d=A[d||(this.editor?this.editor.enterMode:CKEDITOR.ENTER_P)];for(var n;c=f.pop();)c.type==CKEDITOR.NODE_ELEMENT?x(c,d,a):c.remove();for(;l=a.pop();)if(c=l.el,c.parent)switch(n=q[c.parent.name]||q.span,l.check){case "it":q.$removeEmpty[c.name]&&!c.children.length?x(c,d,a):T(c)||x(c,d,a);break;case "el-up":c.parent.type==
CKEDITOR.NODE_DOCUMENT_FRAGMENT||n[c.name]||x(c,d,a);break;case "parent-down":c.parent.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||n[c.name]||x(c.parent,d,a)}return k},checkFeature:function(a){if(this.disabled||!a)return!0;a.toFeature&&(a=a.toFeature(this.editor));return!a.requiredContent||this.check(a.requiredContent)},disable:function(){this.disabled=!0},disallow:function(a){if(!N(this,a,!0))return!1;"string"==typeof a&&(a=D(a));H(this,a,null,this.disallowedContent,this._.disallowedRules);return!0},
addContentForms:function(a){if(!this.disabled&&a){var b,c,d=[],e;for(b=0;b<a.length&&!e;++b)c=a[b],("string"==typeof c||c instanceof CKEDITOR.style)&&this.check(c)&&(e=c);if(e){for(b=0;b<a.length;++b)d.push(ea(a[b],e));this.addTransformations(d)}}},addElementCallback:function(a){this.elementCallbacks||(this.elementCallbacks=[]);this.elementCallbacks.push(a)},addFeature:function(a){if(this.disabled||!a)return!0;a.toFeature&&(a=a.toFeature(this.editor));this.allow(a.allowedContent,a.name);this.addTransformations(a.contentTransformations);
this.addContentForms(a.contentForms);return a.requiredContent&&(this.customConfig||this.disallowedContent.length)?this.check(a.requiredContent):!0},addTransformations:function(a){var b,c;if(!this.disabled&&a){var d=this._.transformations,e;for(e=0;e<a.length;++e){b=a[e];var f=void 0,g=void 0,h=void 0,k=void 0,m=void 0,l=void 0;c=[];for(g=0;g<b.length;++g)h=b[g],"string"==typeof h?(h=h.split(/\s*:\s*/),k=h[0],m=null,l=h[1]):(k=h.check,m=h.left,l=h.right),f||(f=h,f=f.element?f.element:k?k.match(/^([a-z0-9]+)/i)[0]:
f.left.getDefinition().element),m instanceof CKEDITOR.style&&(m=fa(m)),c.push({check:k==f?null:k,left:m,right:"string"==typeof l?ga(l):l});b=f;d[b]||(d[b]=[]);d[b].push(c)}}},check:function(a,b,c){if(this.disabled)return!0;if(CKEDITOR.tools.isArray(a)){for(var d=a.length;d--;)if(this.check(a[d],b,c))return!0;return!1}var e,f;if("string"==typeof a){f=a+"\x3c"+(!1===b?"0":"1")+(c?"1":"0")+"\x3e";if(f in this._.cachedChecks)return this._.cachedChecks[f];d=D(a).$1;e=d.styles;var g=d.classes;d.name=d.elements;
d.classes=g=g?g.split(/\s*,\s*/):[];d.styles=P(e);d.attributes=P(d.attributes);d.children=[];g.length&&(d.attributes["class"]=g.join(" "));e&&(d.attributes.style=CKEDITOR.tools.writeCssText(d.styles));e=d}else d=a.getDefinition(),e=d.styles,g=d.attributes||{},e&&!CKEDITOR.tools.isEmpty(e)?(e=y(e),g.style=CKEDITOR.tools.writeCssText(e,!0)):e={},e={name:d.element,attributes:g,classes:g["class"]?g["class"].split(/\s+/):[],styles:e,children:[]};var g=CKEDITOR.tools.clone(e),h=[],k;if(!1!==b&&(k=this._.transformations[e.name])){for(d=
0;d<k.length;++d)R(this,e,k[d]);S(e)}F(this,g,h,{doFilter:!0,doTransform:!1!==b,skipRequired:!c,skipFinalValidation:!c});b=0<h.length?!1:CKEDITOR.tools.objectCompare(e.attributes,g.attributes,!0)?!0:!1;"string"==typeof a&&(this._.cachedChecks[f]=b);return b},getAllowedEnterMode:function(){var a=["p","div","br"],b={p:CKEDITOR.ENTER_P,div:CKEDITOR.ENTER_DIV,br:CKEDITOR.ENTER_BR};return function(c,d){var e=a.slice(),f;if(this.check(A[c]))return c;for(d||(e=e.reverse());f=e.pop();)if(this.check(f))return b[f];
return CKEDITOR.ENTER_BR}}(),clone:function(){var a=new CKEDITOR.filter,b=CKEDITOR.tools.clone;a.allowedContent=b(this.allowedContent);a._.allowedRules=b(this._.allowedRules);a.disallowedContent=b(this.disallowedContent);a._.disallowedRules=b(this._.disallowedRules);a._.transformations=b(this._.transformations);a.disabled=this.disabled;a.editor=this.editor;return a},destroy:function(){delete CKEDITOR.filter.instances[this.id];delete this._;delete this.allowedContent;delete this.disallowedContent}};
var I={styles:1,attributes:1,classes:1},z={styles:"requiredStyles",attributes:"requiredAttributes",classes:"requiredClasses"},Z=/^([a-z0-9\-*\s]+)((?:\s*\{[!\w\-,\s\*]+\}\s*|\s*\[[!\w\-,\s\*]+\]\s*|\s*\([!\w\-,\s\*]+\)\s*){0,3})(?:;\s*|$)/i,aa={styles:/{([^}]+)}/,attrs:/\[([^\]]+)\]/,classes:/\(([^\)]+)\)/},ba=/^cke:(object|embed|param)$/,ca=/^(object|embed|param)$/,V;V=CKEDITOR.filter.transformationsTools={sizeToStyle:function(a){this.lengthToStyle(a,"width");this.lengthToStyle(a,"height")},sizeToAttribute:function(a){this.lengthToAttribute(a,
"width");this.lengthToAttribute(a,"height")},lengthToStyle:function(a,b,c){c=c||b;if(!(c in a.styles)){var d=a.attributes[b];d&&(/^\d+$/.test(d)&&(d+="px"),a.styles[c]=d)}delete a.attributes[b]},lengthToAttribute:function(a,b,c){c=c||b;if(!(c in a.attributes)){var d=a.styles[b],e=d&&d.match(/^(\d+)(?:\.\d*)?px$/);e?a.attributes[c]=e[1]:"cke-test"==d&&(a.attributes[c]="cke-test")}delete a.styles[b]},alignmentToStyle:function(a){if(!("float"in a.styles)){var b=a.attributes.align;if("left"==b||"right"==
b)a.styles["float"]=b}delete a.attributes.align},alignmentToAttribute:function(a){if(!("align"in a.attributes)){var b=a.styles["float"];if("left"==b||"right"==b)a.attributes.align=b}delete a.styles["float"]},splitBorderShorthand:function(a){function b(b){a.styles["border-top-width"]=c[b[0]];a.styles["border-right-width"]=c[b[1]];a.styles["border-bottom-width"]=c[b[2]];a.styles["border-left-width"]=c[b[3]]}if(a.styles.border){var c=a.styles.border.match(/([\.\d]+\w+)/g)||["0px"];switch(c.length){case 1:a.styles["border-width"]=
c[0];break;case 2:b([0,1,0,1]);break;case 3:b([0,1,2,1]);break;case 4:b([0,1,2,3])}a.styles["border-style"]=a.styles["border-style"]||(a.styles.border.match(/(none|hidden|dotted|dashed|solid|double|groove|ridge|inset|outset|initial|inherit)/)||[])[0];a.styles["border-style"]||delete a.styles["border-style"];delete a.styles.border}},listTypeToStyle:function(a){if(a.attributes.type)switch(a.attributes.type){case "a":a.styles["list-style-type"]="lower-alpha";break;case "A":a.styles["list-style-type"]=
"upper-alpha";break;case "i":a.styles["list-style-type"]="lower-roman";break;case "I":a.styles["list-style-type"]="upper-roman";break;case "1":a.styles["list-style-type"]="decimal";break;default:a.styles["list-style-type"]=a.attributes.type}},splitMarginShorthand:function(a){function b(b){a.styles["margin-top"]=c[b[0]];a.styles["margin-right"]=c[b[1]];a.styles["margin-bottom"]=c[b[2]];a.styles["margin-left"]=c[b[3]]}if(a.styles.margin){var c=a.styles.margin.match(/(\-?[\.\d]+\w+)/g)||["0px"];switch(c.length){case 1:b([0,
0,0,0]);break;case 2:b([0,1,0,1]);break;case 3:b([0,1,2,1]);break;case 4:b([0,1,2,3])}delete a.styles.margin}},matchesStyle:W,transform:function(a,b){if("string"==typeof b)a.name=b;else{var c=b.getDefinition(),d=c.styles,e=c.attributes,f,g,h,k;a.name=c.element;for(f in e)if("class"==f)for(c=a.classes.join("|"),h=e[f].split(/\s+/);k=h.pop();)-1==c.indexOf(k)&&a.classes.push(k);else a.attributes[f]=e[f];for(g in d)a.styles[g]=d[g]}}}})();