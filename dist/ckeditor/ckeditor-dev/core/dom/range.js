/*
 Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
CKEDITOR.dom.range=function(p){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null;this.collapsed=!0;var u=p instanceof CKEDITOR.dom.document;this.document=u?p:p.getDocument();this.root=u?p.getBody():p};
(function(){function p(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer.equals(a.endContainer)&&a.startOffset==a.endOffset}function u(a,c,b,d,e){function f(a,b,c,d){var f=c?a.getPrevious():a.getNext();if(d&&O)return f;g||d?b.append(a.clone(!0,e),c):(a.remove(),B&&b.append(a,c));return f}function k(){var a,b,c,d=Math.min(z.length,v.length);for(a=0;a<d;a++)if(b=z[a],c=v[a],!b.equals(c))return a;return a-1}function m(){var b=E-1,c=p&&C&&!h.equals(n);b<F-1||b<D-1||c?(c?a.moveToPosition(n,
CKEDITOR.POSITION_BEFORE_START):D==b+1&&r?a.moveToPosition(v[b],CKEDITOR.POSITION_BEFORE_END):a.moveToPosition(v[b+1],CKEDITOR.POSITION_BEFORE_START),d&&(b=z[b+1])&&b.type==CKEDITOR.NODE_ELEMENT&&(c=CKEDITOR.dom.element.createFromHtml('\x3cspan data-cke-bookmark\x3d"1" style\x3d"display:none"\x3e\x26nbsp;\x3c/span\x3e',a.document),c.insertAfter(b),b.mergeSiblings(!1),a.moveToBookmark({startNode:c}))):a.collapse(!0)}a.optimizeBookmark();var O=0===c,B=1==c,g=2==c;c=g||B;var h=a.startContainer,n=a.endContainer,
q=a.startOffset,l=a.endOffset,t,r,p,C,x,G;if(g&&n.type==CKEDITOR.NODE_TEXT&&(h.equals(n)||h.type===CKEDITOR.NODE_ELEMENT&&h.getFirst().equals(n)))b.append(a.document.createText(n.substring(q,l)));else{n.type==CKEDITOR.NODE_TEXT?g?G=!0:n=n.split(l):0<n.getChildCount()?l>=n.getChildCount()?(n=n.getChild(l-1),r=!0):n=n.getChild(l):C=r=!0;h.type==CKEDITOR.NODE_TEXT?g?x=!0:h.split(q):0<h.getChildCount()?0===q?(h=h.getChild(q),t=!0):h=h.getChild(q-1):p=t=!0;for(var z=h.getParents(),v=n.getParents(),E=k(),
F=z.length-1,D=v.length-1,y=b,I,H,A,u=-1,w=E;w<=F;w++){H=z[w];A=H.getNext();for(w!=F||H.equals(v[w])&&F<D?c&&(I=y.append(H.clone(0,e))):t?f(H,y,!1,p):x&&y.append(a.document.createText(H.substring(q)));A;){if(A.equals(v[w])){u=w;break}A=f(A,y)}y=I}y=b;for(w=E;w<=D;w++)if(b=v[w],A=b.getPrevious(),b.equals(z[w]))c&&(y=y.getChild(0));else{w!=D||b.equals(z[w])&&D<F?c&&(I=y.append(b.clone(0,e))):r?f(b,y,!1,C):G&&y.append(a.document.createText(b.substring(0,l)));if(w>u)for(;A;)A=f(A,y,!0);y=I}g||m()}}function L(){var a=
!1,c=CKEDITOR.dom.walker.whitespaces(),b=CKEDITOR.dom.walker.bookmark(!0),d=CKEDITOR.dom.walker.bogus();return function(e){return b(e)||c(e)?!0:d(e)&&!a?a=!0:e.type==CKEDITOR.NODE_TEXT&&(e.hasAscendant("pre")||CKEDITOR.tools.trim(e.getText()).length)||e.type==CKEDITOR.NODE_ELEMENT&&!e.is(P)?!1:!0}}function Q(a){var c=CKEDITOR.dom.walker.whitespaces(),b=CKEDITOR.dom.walker.bookmark(1);return function(d){return b(d)||c(d)?!0:!a&&M(d)||d.type==CKEDITOR.NODE_ELEMENT&&d.is(CKEDITOR.dtd.$removeEmpty)}}
function N(a){return function(){var c;return this[a?"getPreviousNode":"getNextNode"](function(a){!c&&J(a)&&(c=a);return R(a)&&!(M(a)&&a.equals(c))})}}var P={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},M=CKEDITOR.dom.walker.bogus(),K=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,R=CKEDITOR.dom.walker.editable(),J=CKEDITOR.dom.walker.ignored(!0);CKEDITOR.dom.range.prototype={clone:function(){var a=
new CKEDITOR.dom.range(this.root);a._setStartContainer(this.startContainer);a.startOffset=this.startOffset;a._setEndContainer(this.endContainer);a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},collapse:function(a){a?(this._setEndContainer(this.startContainer),this.endOffset=this.startOffset):(this._setStartContainer(this.endContainer),this.startOffset=this.endOffset);this.collapsed=!0},cloneContents:function(a){var c=new CKEDITOR.dom.documentFragment(this.document);this.collapsed||
u(this,2,c,!1,"undefined"==typeof a?!0:a);return c},deleteContents:function(a){this.collapsed||u(this,0,null,a)},extractContents:function(a,c){var b=new CKEDITOR.dom.documentFragment(this.document);this.collapsed||u(this,1,b,a,"undefined"==typeof c?!0:c);return b},createBookmark:function(a){var c,b,d,e,f=this.collapsed;c=this.document.createElement("span");c.data("cke-bookmark",1);c.setStyle("display","none");c.setHtml("\x26nbsp;");a&&(d="cke_bm_"+CKEDITOR.tools.getNextNumber(),c.setAttribute("id",
d+(f?"C":"S")));f||(b=c.clone(),b.setHtml("\x26nbsp;"),a&&b.setAttribute("id",d+"E"),e=this.clone(),e.collapse(),e.insertNode(b));e=this.clone();e.collapse(!0);e.insertNode(c);b?(this.setStartAfter(c),this.setEndBefore(b)):this.moveToPosition(c,CKEDITOR.POSITION_AFTER_END);return{startNode:a?d+(f?"C":"S"):c,endNode:a?d+"E":b,serializable:a,collapsed:f}},createBookmark2:function(){function a(a){var c=a.container,f=a.offset,k;k=c;var m=f;k=k.type!=CKEDITOR.NODE_ELEMENT||0===m||m==k.getChildCount()?
0:k.getChild(m-1).type==CKEDITOR.NODE_TEXT&&k.getChild(m).type==CKEDITOR.NODE_TEXT;k&&(c=c.getChild(f-1),f=c.getLength());if(c.type==CKEDITOR.NODE_ELEMENT&&0<f){a:{for(k=c;f--;)if(m=k.getChild(f).getIndex(!0),0<=m){f=m;break a}f=-1}f+=1}if(c.type==CKEDITOR.NODE_TEXT){k=c;for(m=0;(k=k.getPrevious())&&k.type==CKEDITOR.NODE_TEXT;)m+=k.getText().replace(CKEDITOR.dom.selection.FILLING_CHAR_SEQUENCE,"").length;k=m;c.getText()?f+=k:(m=c.getPrevious(b),k?(f=k,c=m?m.getNext():c.getParent().getFirst()):(c=
c.getParent(),f=m?m.getIndex(!0)+1:0))}a.container=c;a.offset=f}function c(a,c){var b=c.getCustomData("cke-fillingChar");if(b){var k=a.container;b.equals(k)&&(a.offset-=CKEDITOR.dom.selection.FILLING_CHAR_SEQUENCE.length,0>=a.offset&&(a.offset=k.getIndex(),a.container=k.getParent()))}}var b=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_TEXT,!0);return function(b){var e=this.collapsed,f={container:this.startContainer,offset:this.startOffset},k={container:this.endContainer,offset:this.endOffset};b&&(a(f),
c(f,this.root),e||(a(k),c(k,this.root)));return{start:f.container.getAddress(b),end:e?null:k.container.getAddress(b),startOffset:f.offset,endOffset:k.offset,normalized:b,collapsed:e,is2:!0}}}(),moveToBookmark:function(a){if(a.is2){var c=this.document.getByAddress(a.start,a.normalized),b=a.startOffset,d=a.end&&this.document.getByAddress(a.end,a.normalized);a=a.endOffset;this.setStart(c,b);d?this.setEnd(d,a):this.collapse(!0)}else c=(b=a.serializable)?this.document.getById(a.startNode):a.startNode,
a=b?this.document.getById(a.endNode):a.endNode,this.setStartBefore(c),c.remove(),a?(this.setEndBefore(a),a.remove()):this.collapse(!0)},getBoundaryNodes:function(){var a=this.startContainer,c=this.endContainer,b=this.startOffset,d=this.endOffset,e;if(a.type==CKEDITOR.NODE_ELEMENT)if(e=a.getChildCount(),e>b)a=a.getChild(b);else if(1>e)a=a.getPreviousSourceNode();else{for(a=a.$;a.lastChild;)a=a.lastChild;a=new CKEDITOR.dom.node(a);a=a.getNextSourceNode()||a}if(c.type==CKEDITOR.NODE_ELEMENT)if(e=c.getChildCount(),
e>d)c=c.getChild(d).getPreviousSourceNode(!0);else if(1>e)c=c.getPreviousSourceNode();else{for(c=c.$;c.lastChild;)c=c.lastChild;c=new CKEDITOR.dom.node(c)}a.getPosition(c)&CKEDITOR.POSITION_FOLLOWING&&(a=c);return{startNode:a,endNode:c}},getCommonAncestor:function(a,c){var b=this.startContainer,d=this.endContainer,b=b.equals(d)?a&&b.type==CKEDITOR.NODE_ELEMENT&&this.startOffset==this.endOffset-1?b.getChild(this.startOffset):b:b.getCommonAncestor(d);return c&&!b.is?b.getParent():b},optimize:function(){var a=
this.startContainer,c=this.startOffset;a.type!=CKEDITOR.NODE_ELEMENT&&(c?c>=a.getLength()&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;c=this.endOffset;a.type!=CKEDITOR.NODE_ELEMENT&&(c?c>=a.getLength()&&this.setEndAfter(a):this.setEndBefore(a))},optimizeBookmark:function(){var a=this.startContainer,c=this.endContainer;a.is&&a.is("span")&&a.data("cke-bookmark")&&this.setStartAt(a,CKEDITOR.POSITION_BEFORE_START);c&&c.is&&c.is("span")&&c.data("cke-bookmark")&&this.setEndAt(c,CKEDITOR.POSITION_AFTER_END)},
trim:function(a,c){var b=this.startContainer,d=this.startOffset,e=this.collapsed;if((!a||e)&&b&&b.type==CKEDITOR.NODE_TEXT){if(d)if(d>=b.getLength())d=b.getIndex()+1,b=b.getParent();else{var f=b.split(d),d=b.getIndex()+1,b=b.getParent();this.startContainer.equals(this.endContainer)?this.setEnd(f,this.endOffset-this.startOffset):b.equals(this.endContainer)&&(this.endOffset+=1)}else d=b.getIndex(),b=b.getParent();this.setStart(b,d);if(e){this.collapse(!0);return}}b=this.endContainer;d=this.endOffset;
c||e||!b||b.type!=CKEDITOR.NODE_TEXT||(d?(d>=b.getLength()||b.split(d),d=b.getIndex()+1):d=b.getIndex(),b=b.getParent(),this.setEnd(b,d))},enlarge:function(a,c){function b(a){return a&&a.type==CKEDITOR.NODE_ELEMENT&&a.hasAttribute("contenteditable")?null:a}var d=new RegExp(/[^\s\ufeff]/);switch(a){case CKEDITOR.ENLARGE_INLINE:var e=1;case CKEDITOR.ENLARGE_ELEMENT:var f=function(a,c){var b=new CKEDITOR.dom.range(m);b.setStart(a,c);b.setEndAt(m,CKEDITOR.POSITION_BEFORE_END);var b=new CKEDITOR.dom.walker(b),
e;for(b.guard=function(a){return!(a.type==CKEDITOR.NODE_ELEMENT&&a.isBlockBoundary())};e=b.next();){if(e.type!=CKEDITOR.NODE_TEXT)return!1;t=e!=a?e.getText():e.substring(c);if(d.test(t))return!1}return!0};if(this.collapsed)break;var k=this.getCommonAncestor(),m=this.root,p,B,g,h,n,q=!1,l,t;l=this.startContainer;var r=this.startOffset;l.type==CKEDITOR.NODE_TEXT?(r&&(l=!CKEDITOR.tools.trim(l.substring(0,r)).length&&l,q=!!l),l&&((h=l.getPrevious())||(g=l.getParent()))):(r&&(h=l.getChild(r-1)||l.getLast()),
h||(g=l));for(g=b(g);g||h;){if(g&&!h){!n&&g.equals(k)&&(n=!0);if(e?g.isBlockBoundary():!m.contains(g))break;q&&"inline"==g.getComputedStyle("display")||(q=!1,n?p=g:this.setStartBefore(g));h=g.getPrevious()}for(;h;)if(l=!1,h.type==CKEDITOR.NODE_COMMENT)h=h.getPrevious();else{if(h.type==CKEDITOR.NODE_TEXT)t=h.getText(),d.test(t)&&(h=null),l=/[\s\ufeff]$/.test(t);else if((h.$.offsetWidth>(CKEDITOR.env.webkit?1:0)||c&&h.is("br"))&&!h.data("cke-bookmark"))if(q&&CKEDITOR.dtd.$removeEmpty[h.getName()]){t=
h.getText();if(d.test(t))h=null;else for(var r=h.$.getElementsByTagName("*"),u=0,C;C=r[u++];)if(!CKEDITOR.dtd.$removeEmpty[C.nodeName.toLowerCase()]){h=null;break}h&&(l=!!t.length)}else h=null;l&&(q?n?p=g:g&&this.setStartBefore(g):q=!0);if(h){l=h.getPrevious();if(!g&&!l){g=h;h=null;break}h=l}else g=null}g&&(g=b(g.getParent()))}l=this.endContainer;r=this.endOffset;g=h=null;n=q=!1;l.type==CKEDITOR.NODE_TEXT?CKEDITOR.tools.trim(l.substring(r)).length?q=!0:(q=!l.getLength(),r==l.getLength()?(h=l.getNext())||
(g=l.getParent()):f(l,r)&&(g=l.getParent())):(h=l.getChild(r))||(g=l);for(;g||h;){if(g&&!h){!n&&g.equals(k)&&(n=!0);if(e?g.isBlockBoundary():!m.contains(g))break;q&&"inline"==g.getComputedStyle("display")||(q=!1,n?B=g:g&&this.setEndAfter(g));h=g.getNext()}for(;h;){l=!1;if(h.type==CKEDITOR.NODE_TEXT)t=h.getText(),f(h,0)||(h=null),l=/^[\s\ufeff]/.test(t);else if(h.type==CKEDITOR.NODE_ELEMENT){if((0<h.$.offsetWidth||c&&h.is("br"))&&!h.data("cke-bookmark"))if(q&&CKEDITOR.dtd.$removeEmpty[h.getName()]){t=
h.getText();if(d.test(t))h=null;else for(r=h.$.getElementsByTagName("*"),u=0;C=r[u++];)if(!CKEDITOR.dtd.$removeEmpty[C.nodeName.toLowerCase()]){h=null;break}h&&(l=!!t.length)}else h=null}else l=1;l&&q&&(n?B=g:this.setEndAfter(g));if(h){l=h.getNext();if(!g&&!l){g=h;h=null;break}h=l}else g=null}g&&(g=b(g.getParent()))}p&&B&&(k=p.contains(B)?B:p,this.setStartBefore(k),this.setEndAfter(k));break;case CKEDITOR.ENLARGE_BLOCK_CONTENTS:case CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:g=new CKEDITOR.dom.range(this.root);
m=this.root;g.setStartAt(m,CKEDITOR.POSITION_AFTER_START);g.setEnd(this.startContainer,this.startOffset);g=new CKEDITOR.dom.walker(g);var x,G,z=CKEDITOR.dom.walker.blockBoundary(a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),v=null,E=function(a){if(a.type==CKEDITOR.NODE_ELEMENT&&"false"==a.getAttribute("contenteditable"))if(v){if(v.equals(a)){v=null;return}}else v=a;else if(v)return;var b=z(a);b||(x=a);return b},e=function(a){var b=E(a);!b&&a.is&&a.is("br")&&(G=a);return b};g.guard=E;g=g.lastBackward();
x=x||m;this.setStartAt(x,!x.is("br")&&(!g&&this.checkStartOfBlock()||g&&x.contains(g))?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_AFTER_END);if(a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS){g=this.clone();g=new CKEDITOR.dom.walker(g);var F=CKEDITOR.dom.walker.whitespaces(),D=CKEDITOR.dom.walker.bookmark();g.evaluator=function(a){return!F(a)&&!D(a)};if((g=g.previous())&&g.type==CKEDITOR.NODE_ELEMENT&&g.is("br"))break}g=this.clone();g.collapse();g.setEndAt(m,CKEDITOR.POSITION_BEFORE_END);g=new CKEDITOR.dom.walker(g);
g.guard=a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?e:E;x=v=G=null;g=g.lastForward();x=x||m;this.setEndAt(x,!g&&this.checkEndOfBlock()||g&&x.contains(g)?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START);G&&this.setEndAfter(G)}},shrink:function(a,c,b){var d="boolean"===typeof b?b:b&&"boolean"===typeof b.shrinkOnBlockBoundary?b.shrinkOnBlockBoundary:!0,e=b&&b.skipBogus;if(!this.collapsed){a=a||CKEDITOR.SHRINK_TEXT;var f=this.clone(),k=this.startContainer,m=this.endContainer,p=this.startOffset,
u=this.endOffset,g=b=1;k&&k.type==CKEDITOR.NODE_TEXT&&(p?p>=k.getLength()?f.setStartAfter(k):(f.setStartBefore(k),b=0):f.setStartBefore(k));m&&m.type==CKEDITOR.NODE_TEXT&&(u?u>=m.getLength()?f.setEndAfter(m):(f.setEndAfter(m),g=0):f.setEndBefore(m));var f=new CKEDITOR.dom.walker(f),h=CKEDITOR.dom.walker.bookmark(),n=CKEDITOR.dom.walker.bogus();f.evaluator=function(b){return b.type==(a==CKEDITOR.SHRINK_ELEMENT?CKEDITOR.NODE_ELEMENT:CKEDITOR.NODE_TEXT)};var q;f.guard=function(b,c){if(e&&n(b)||h(b))return!0;
if(a==CKEDITOR.SHRINK_ELEMENT&&b.type==CKEDITOR.NODE_TEXT||c&&b.equals(q)||!1===d&&b.type==CKEDITOR.NODE_ELEMENT&&b.isBlockBoundary()||b.type==CKEDITOR.NODE_ELEMENT&&b.hasAttribute("contenteditable"))return!1;c||b.type!=CKEDITOR.NODE_ELEMENT||(q=b);return!0};b&&(k=f[a==CKEDITOR.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(k,c?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_START);g&&(f.reset(),(f=f[a==CKEDITOR.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(f,c?CKEDITOR.POSITION_BEFORE_END:
CKEDITOR.POSITION_AFTER_END));return!(!b&&!g)}},insertNode:function(a){this.optimizeBookmark();this.trim(!1,!0);var c=this.startContainer,b=c.getChild(this.startOffset);b?a.insertBefore(b):c.append(a);a.getParent()&&a.getParent().equals(this.endContainer)&&this.endOffset++;this.setStartBefore(a)},moveToPosition:function(a,c){this.setStartAt(a,c);this.collapse(!0)},moveToRange:function(a){this.setStart(a.startContainer,a.startOffset);this.setEnd(a.endContainer,a.endOffset)},selectNodeContents:function(a){this.setStart(a,
0);this.setEnd(a,a.type==CKEDITOR.NODE_TEXT?a.getLength():a.getChildCount())},setStart:function(a,c){a.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[a.getName()]&&(c=a.getIndex(),a=a.getParent());this._setStartContainer(a);this.startOffset=c;this.endContainer||(this._setEndContainer(a),this.endOffset=c);p(this)},setEnd:function(a,c){a.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[a.getName()]&&(c=a.getIndex()+1,a=a.getParent());this._setEndContainer(a);this.endOffset=c;this.startContainer||
(this._setStartContainer(a),this.startOffset=c);p(this)},setStartAfter:function(a){this.setStart(a.getParent(),a.getIndex()+1)},setStartBefore:function(a){this.setStart(a.getParent(),a.getIndex())},setEndAfter:function(a){this.setEnd(a.getParent(),a.getIndex()+1)},setEndBefore:function(a){this.setEnd(a.getParent(),a.getIndex())},setStartAt:function(a,c){switch(c){case CKEDITOR.POSITION_AFTER_START:this.setStart(a,0);break;case CKEDITOR.POSITION_BEFORE_END:a.type==CKEDITOR.NODE_TEXT?this.setStart(a,
a.getLength()):this.setStart(a,a.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setStartBefore(a);break;case CKEDITOR.POSITION_AFTER_END:this.setStartAfter(a)}p(this)},setEndAt:function(a,c){switch(c){case CKEDITOR.POSITION_AFTER_START:this.setEnd(a,0);break;case CKEDITOR.POSITION_BEFORE_END:a.type==CKEDITOR.NODE_TEXT?this.setEnd(a,a.getLength()):this.setEnd(a,a.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setEndBefore(a);break;case CKEDITOR.POSITION_AFTER_END:this.setEndAfter(a)}p(this)},
fixBlock:function(a,c){var b=this.createBookmark(),d=this.document.createElement(c);this.collapse(a);this.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS);this.extractContents().appendTo(d);d.trim();this.insertNode(d);var e=d.getBogus();e&&e.remove();d.appendBogus();this.moveToBookmark(b);return d},splitBlock:function(a,c){var b=new CKEDITOR.dom.elementPath(this.startContainer,this.root),d=new CKEDITOR.dom.elementPath(this.endContainer,this.root),e=b.block,f=d.block,k=null;if(!b.blockLimit.equals(d.blockLimit))return null;
"br"!=a&&(e||(e=this.fixBlock(!0,a),f=(new CKEDITOR.dom.elementPath(this.endContainer,this.root)).block),f||(f=this.fixBlock(!1,a)));b=e&&this.checkStartOfBlock();d=f&&this.checkEndOfBlock();this.deleteContents();e&&e.equals(f)&&(d?(k=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(f,CKEDITOR.POSITION_AFTER_END),f=null):b?(k=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(e,CKEDITOR.POSITION_BEFORE_START),e=null):(f=this.splitElement(e,
c||!1),e.is("ul","ol")||e.appendBogus()));return{previousBlock:e,nextBlock:f,wasStartOfBlock:b,wasEndOfBlock:d,elementPath:k}},splitElement:function(a,c){if(!this.collapsed)return null;this.setEndAt(a,CKEDITOR.POSITION_BEFORE_END);var b=this.extractContents(!1,c||!1),d=a.clone(!1,c||!1);b.appendTo(d);d.insertAfter(a);this.moveToPosition(a,CKEDITOR.POSITION_AFTER_END);return d},removeEmptyBlocksAtEnd:function(){function a(a){return function(e){return c(e)||b(e)||e.type==CKEDITOR.NODE_ELEMENT&&e.isEmptyInlineRemoveable()||
a.is("table")&&e.is("caption")?!1:!0}}var c=CKEDITOR.dom.walker.whitespaces(),b=CKEDITOR.dom.walker.bookmark(!1);return function(b){for(var c=this.createBookmark(),f=this[b?"endPath":"startPath"](),k=f.block||f.blockLimit,m;k&&!k.equals(f.root)&&!k.getFirst(a(k));)m=k.getParent(),this[b?"setEndAt":"setStartAt"](k,CKEDITOR.POSITION_AFTER_END),k.remove(1),k=m;this.moveToBookmark(c)}}(),startPath:function(){return new CKEDITOR.dom.elementPath(this.startContainer,this.root)},endPath:function(){return new CKEDITOR.dom.elementPath(this.endContainer,
this.root)},checkBoundaryOfElement:function(a,c){var b=c==CKEDITOR.START,d=this.clone();d.collapse(b);d[b?"setStartAt":"setEndAt"](a,b?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END);d=new CKEDITOR.dom.walker(d);d.evaluator=Q(b);return d[b?"checkBackward":"checkForward"]()},checkStartOfBlock:function(){var a=this.startContainer,c=this.startOffset;CKEDITOR.env.ie&&c&&a.type==CKEDITOR.NODE_TEXT&&(a=CKEDITOR.tools.ltrim(a.substring(0,c)),K.test(a)&&this.trim(0,1));this.trim();a=new CKEDITOR.dom.elementPath(this.startContainer,
this.root);c=this.clone();c.collapse(!0);c.setStartAt(a.block||a.blockLimit,CKEDITOR.POSITION_AFTER_START);a=new CKEDITOR.dom.walker(c);a.evaluator=L();return a.checkBackward()},checkEndOfBlock:function(){var a=this.endContainer,c=this.endOffset;CKEDITOR.env.ie&&a.type==CKEDITOR.NODE_TEXT&&(a=CKEDITOR.tools.rtrim(a.substring(c)),K.test(a)&&this.trim(1,0));this.trim();a=new CKEDITOR.dom.elementPath(this.endContainer,this.root);c=this.clone();c.collapse(!1);c.setEndAt(a.block||a.blockLimit,CKEDITOR.POSITION_BEFORE_END);
a=new CKEDITOR.dom.walker(c);a.evaluator=L();return a.checkForward()},getPreviousNode:function(a,c,b){var d=this.clone();d.collapse(1);d.setStartAt(b||this.root,CKEDITOR.POSITION_AFTER_START);b=new CKEDITOR.dom.walker(d);b.evaluator=a;b.guard=c;return b.previous()},getNextNode:function(a,c,b){var d=this.clone();d.collapse();d.setEndAt(b||this.root,CKEDITOR.POSITION_BEFORE_END);b=new CKEDITOR.dom.walker(d);b.evaluator=a;b.guard=c;return b.next()},checkReadOnly:function(){function a(a,b){for(;a;){if(a.type==
CKEDITOR.NODE_ELEMENT){if("false"==a.getAttribute("contentEditable")&&!a.data("cke-editable"))return 0;if(a.is("html")||"true"==a.getAttribute("contentEditable")&&(a.contains(b)||a.equals(b)))break}a=a.getParent()}return 1}return function(){var c=this.startContainer,b=this.endContainer;return!(a(c,b)&&a(b,c))}}(),moveToElementEditablePosition:function(a,c){if(a.type==CKEDITOR.NODE_ELEMENT&&!a.isEditable(!1))return this.moveToPosition(a,c?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),
!0;for(var b=0;a;){if(a.type==CKEDITOR.NODE_TEXT){c&&this.endContainer&&this.checkEndOfBlock()&&K.test(a.getText())?this.moveToPosition(a,CKEDITOR.POSITION_BEFORE_START):this.moveToPosition(a,c?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START);b=1;break}if(a.type==CKEDITOR.NODE_ELEMENT)if(a.isEditable())this.moveToPosition(a,c?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_START),b=1;else if(c&&a.is("br")&&this.endContainer&&this.checkEndOfBlock())this.moveToPosition(a,CKEDITOR.POSITION_BEFORE_START);
else if("false"==a.getAttribute("contenteditable")&&a.is(CKEDITOR.dtd.$block))return this.setStartBefore(a),this.setEndAfter(a),!0;var d=a,e=b,f=void 0;d.type==CKEDITOR.NODE_ELEMENT&&d.isEditable(!1)&&(f=d[c?"getLast":"getFirst"](J));e||f||(f=d[c?"getPrevious":"getNext"](J));a=f}return!!b},moveToClosestEditablePosition:function(a,c){var b,d=0,e,f,k=[CKEDITOR.POSITION_AFTER_END,CKEDITOR.POSITION_BEFORE_START];a?(b=new CKEDITOR.dom.range(this.root),b.moveToPosition(a,k[c?0:1])):b=this.clone();if(a&&
!a.is(CKEDITOR.dtd.$block))d=1;else if(e=b[c?"getNextEditableNode":"getPreviousEditableNode"]())d=1,(f=e.type==CKEDITOR.NODE_ELEMENT)&&e.is(CKEDITOR.dtd.$block)&&"false"==e.getAttribute("contenteditable")?(b.setStartAt(e,CKEDITOR.POSITION_BEFORE_START),b.setEndAt(e,CKEDITOR.POSITION_AFTER_END)):!CKEDITOR.env.needsBrFiller&&f&&e.is(CKEDITOR.dom.walker.validEmptyBlockContainers)?(b.setEnd(e,0),b.collapse()):b.moveToPosition(e,k[c?1:0]);d&&this.moveToRange(b);return!!d},moveToElementEditStart:function(a){return this.moveToElementEditablePosition(a)},
moveToElementEditEnd:function(a){return this.moveToElementEditablePosition(a,!0)},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer.type!=CKEDITOR.NODE_ELEMENT||a.endContainer.type!=CKEDITOR.NODE_ELEMENT)return null;var a=new CKEDITOR.dom.walker(a),c=CKEDITOR.dom.walker.bookmark(!1,!0),b=CKEDITOR.dom.walker.whitespaces(!0);a.evaluator=function(a){return b(a)&&c(a)};var d=a.next();a.reset();return d&&d.equals(a.previous())?d:null},getTouchedStartNode:function(){var a=this.startContainer;
return this.collapsed||a.type!=CKEDITOR.NODE_ELEMENT?a:a.getChild(this.startOffset)||a},getTouchedEndNode:function(){var a=this.endContainer;return this.collapsed||a.type!=CKEDITOR.NODE_ELEMENT?a:a.getChild(this.endOffset-1)||a},getNextEditableNode:N(),getPreviousEditableNode:N(1),_getTableElement:function(a){a=a||{td:1,th:1,tr:1,tbody:1,thead:1,tfoot:1,table:1};var c=this.startContainer,b=this.endContainer,d=c.getAscendant("table",!0),e=b.getAscendant("table",!0);return CKEDITOR.env.safari&&d&&b.equals(this.root)?
c.getAscendant(a,!0):this.getEnclosedNode()?this.getEnclosedNode().getAscendant(a,!0):d&&e&&(d.equals(e)||d.contains(e)||e.contains(d))?c.getAscendant(a,!0):null},scrollIntoView:function(){var a=new CKEDITOR.dom.element.createFromHtml("\x3cspan\x3e\x26nbsp;\x3c/span\x3e",this.document),c,b,d,e=this.clone();e.optimize();(d=e.startContainer.type==CKEDITOR.NODE_TEXT)?(b=e.startContainer.getText(),c=e.startContainer.split(e.startOffset),a.insertAfter(e.startContainer)):e.insertNode(a);a.scrollIntoView();
d&&(e.startContainer.setText(b),c.remove());a.remove()},_setStartContainer:function(a){this.startContainer=a},_setEndContainer:function(a){this.endContainer=a},_find:function(a,c){var b=this.getCommonAncestor(),d=this.getBoundaryNodes(),e=[],f,k,m,p;if(b&&b.find)for(k=b.find(a),f=0;f<k.count();f++)if(b=k.getItem(f),c||!b.isReadOnly())m=b.getPosition(d.startNode)&CKEDITOR.POSITION_FOLLOWING||d.startNode.equals(b),p=b.getPosition(d.endNode)&CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_IS_CONTAINED||
d.endNode.equals(b),m&&p&&e.push(b);return e}};CKEDITOR.dom.range.mergeRanges=function(a){return CKEDITOR.tools.array.reduce(a,function(a,b){var d=a[a.length-1],e=!1;b=b.clone();b.enlarge(CKEDITOR.ENLARGE_ELEMENT);if(d){var f=new CKEDITOR.dom.range(b.root),e=new CKEDITOR.dom.walker(f),k=CKEDITOR.dom.walker.whitespaces();f.setStart(d.endContainer,d.endOffset);f.setEnd(b.startContainer,b.startOffset);for(f=e.next();k(f)||b.endContainer.equals(f);)f=e.next();e=!f}e?d.setEnd(b.endContainer,b.endOffset):
a.push(b);return a},[])}})();CKEDITOR.POSITION_AFTER_START=1;CKEDITOR.POSITION_BEFORE_END=2;CKEDITOR.POSITION_BEFORE_START=3;CKEDITOR.POSITION_AFTER_END=4;CKEDITOR.ENLARGE_ELEMENT=1;CKEDITOR.ENLARGE_BLOCK_CONTENTS=2;CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS=3;CKEDITOR.ENLARGE_INLINE=4;CKEDITOR.START=1;CKEDITOR.END=2;CKEDITOR.SHRINK_ELEMENT=1;CKEDITOR.SHRINK_TEXT=2;