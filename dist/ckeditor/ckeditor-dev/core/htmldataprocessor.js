/*
 Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
(function(){function r(a,b){function d(a){return a||CKEDITOR.env.needsNbspFiller?new CKEDITOR.htmlParser.text(" "):new CKEDITOR.htmlParser.element("br",{"data-cke-bogus":1})}function e(a,b){return function(c){if(c.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var e=[],g=t(c),k,l;if(g)for(f(g,1)&&e.push(g);g;)m(g)&&(k=n(g))&&f(k)&&((l=n(k))&&!m(l)?e.push(k):(d(h).insertAfter(k),k.remove())),g=g.previous;for(g=0;g<e.length;g++)e[g].remove();if(e=!a||!1!==("function"==typeof b?b(c):b))h||CKEDITOR.env.needsBrFiller||
c.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT?h||CKEDITOR.env.needsBrFiller||!(7<document.documentMode||c.name in CKEDITOR.dtd.tr||c.name in CKEDITOR.dtd.$listItem)?(e=t(c),e=!e||"form"==c.name&&"input"==e.name):e=!1:e=!1;e&&c.add(d(a))}}}function f(a,b){if((!h||CKEDITOR.env.needsBrFiller)&&a.type==CKEDITOR.NODE_ELEMENT&&"br"==a.name&&!a.attributes["data-cke-eol"])return!0;var c;return a.type==CKEDITOR.NODE_TEXT&&(c=a.value.match(E))&&(c.index&&((new CKEDITOR.htmlParser.text(a.value.substring(0,c.index))).insertBefore(a),
a.value=c[0]),!CKEDITOR.env.needsBrFiller&&h&&(!b||a.parent.name in g)||!h&&((c=a.previous)&&"br"==c.name||!c||m(c)))?!0:!1}var c={elements:{}},h="html"==b,g=CKEDITOR.tools.extend({},u),k;for(k in g)"#"in p[k]||delete g[k];for(k in g)c.elements[k]=e(h,a.config.fillEmptyBlocks);c.root=e(h,!1);c.elements.br=function(a){return function(c){if(c.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var b=c.attributes;if("data-cke-bogus"in b||"data-cke-eol"in b)delete b["data-cke-bogus"];else{for(b=c.next;b&&q(b);)b=
b.next;var f=n(c);!b&&m(c.parent)?v(c.parent,d(a)):m(b)&&f&&!m(f)&&d(a).insertBefore(b)}}}}(h);return c}function w(a,b){return a!=CKEDITOR.ENTER_BR&&!1!==b?a==CKEDITOR.ENTER_DIV?"div":"p":!1}function t(a){for(a=a.children[a.children.length-1];a&&q(a);)a=a.previous;return a}function n(a){for(a=a.previous;a&&q(a);)a=a.previous;return a}function q(a){return a.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(a.value)||a.type==CKEDITOR.NODE_ELEMENT&&a.attributes["data-cke-bookmark"]}function m(a){return a&&
(a.type==CKEDITOR.NODE_ELEMENT&&a.name in u||a.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)}function v(a,b){var d=a.children[a.children.length-1];a.children.push(b);b.parent=a;d&&(d.next=b,b.previous=d)}function x(a){a=a.attributes;"false"!=a.contenteditable&&(a["data-cke-editable"]=a.contenteditable?"true":1);a.contenteditable="false"}function y(a){a=a.attributes;switch(a["data-cke-editable"]){case "true":a.contenteditable="true";break;case "1":delete a.contenteditable}}function F(a){return a.replace(G,
function(a,d,e){return"\x3c"+d+e.replace(H,function(a,b){return I.test(b)&&-1==e.indexOf("data-cke-saved-"+b)?" data-cke-saved-"+a+" data-cke-"+CKEDITOR.rnd+"-"+a:a})+"\x3e"})}function z(a,b){return a.replace(b,function(a,b,f){0===a.indexOf("\x3ctextarea")&&(a=b+l(f).replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;")+"\x3c/textarea\x3e");return"\x3ccke:encoded\x3e"+encodeURIComponent(a)+"\x3c/cke:encoded\x3e"})}function J(a){return a.replace(K,function(a,d){return decodeURIComponent(d)})}function L(a){return a.replace(/\x3c!--(?!{cke_protected})[\s\S]+?--\x3e/g,
function(a){return"\x3c!--"+A+"{C}"+encodeURIComponent(a).replace(/--/g,"%2D%2D")+"--\x3e"})}function l(a){return a.replace(/\x3c!--\{cke_protected\}\{C\}([\s\S]+?)--\x3e/g,function(a,d){return decodeURIComponent(d)})}function B(a,b){var d=b._.dataStore;return a.replace(/\x3c!--\{cke_protected\}([\s\S]+?)--\x3e/g,function(a,b){return decodeURIComponent(b)}).replace(/\{cke_protected_(\d+)\}/g,function(a,b){return d&&d[b]||""})}function M(a,b){var d=[],e=b.config.protectedSource,f=b._.dataStore||(b._.dataStore=
{id:1}),c=/<\!--\{cke_temp(comment)?\}(\d*?)--\x3e/g,e=[/<script[\s\S]*?(<\/script>|$)/gi,/<noscript[\s\S]*?<\/noscript>/gi,/<meta[\s\S]*?\/?>/gi].concat(e);a=a.replace(/\x3c!--[\s\S]*?--\x3e/g,function(a){return"\x3c!--{cke_tempcomment}"+(d.push(a)-1)+"--\x3e"});for(var h=0;h<e.length;h++)a=a.replace(e[h],function(a){a=a.replace(c,function(a,b,c){return d[c]});return/cke_temp(comment)?/.test(a)?a:"\x3c!--{cke_temp}"+(d.push(a)-1)+"--\x3e"});a=a.replace(c,function(a,b,c){return"\x3c!--"+A+(b?"{C}":
"")+encodeURIComponent(d[c]).replace(/--/g,"%2D%2D")+"--\x3e"});a=a.replace(/<\w+(?:\s+(?:(?:[^\s=>]+\s*=\s*(?:[^'"\s>]+|'[^']*'|"[^"]*"))|[^\s=\/>]+))+\s*\/?>/g,function(a){return a.replace(/\x3c!--\{cke_protected\}([^>]*)--\x3e/g,function(a,b){f[f.id]=decodeURIComponent(b);return"{cke_protected_"+f.id++ +"}"})});return a=a.replace(/<(title|iframe|textarea)([^>]*)>([\s\S]*?)<\/\1>/g,function(a,c,f,d){return"\x3c"+c+f+"\x3e"+B(l(d),b)+"\x3c/"+c+"\x3e"})}CKEDITOR.htmlDataProcessor=function(a){var b,
d,e=this;this.editor=a;this.dataFilter=b=new CKEDITOR.htmlParser.filter;this.htmlFilter=d=new CKEDITOR.htmlParser.filter;this.writer=new CKEDITOR.htmlParser.basicWriter;b.addRules(N);b.addRules(O,{applyToAll:!0});b.addRules(r(a,"data"),{applyToAll:!0});d.addRules(P);d.addRules(C,{applyToAll:!0});d.addRules(r(a,"html"),{applyToAll:!0});a.on("toHtml",function(b){b=b.data;var c=b.dataValue,d,c=M(c,a),c=z(c,Q),c=F(c),c=z(c,R),c=c.replace(S,"$1cke:$2"),c=c.replace(T,"\x3ccke:$1$2\x3e\x3c/cke:$1\x3e"),
c=c.replace(/(<pre\b[^>]*>)(\r\n|\n)/g,"$1$2$2"),c=c.replace(/([^a-z0-9<\-])(on\w{3,})(?!>)/gi,"$1data-cke-"+CKEDITOR.rnd+"-$2");d=b.context||a.editable().getName();var e;CKEDITOR.env.ie&&9>CKEDITOR.env.version&&"pre"==d&&(d="div",c="\x3cpre\x3e"+c+"\x3c/pre\x3e",e=1);d=a.document.createElement(d);d.setHtml("a"+c);c=d.getHtml().substr(1);c=c.replace(new RegExp("data-cke-"+CKEDITOR.rnd+"-","ig"),"");e&&(c=c.replace(/^<pre>|<\/pre>$/gi,""));c=c.replace(U,"$1$2");c=J(c);c=l(c);d=!1===b.fixForBody?!1:
w(b.enterMode,a.config.autoParagraph);c=CKEDITOR.htmlParser.fragment.fromHtml(c,b.context,d);d&&(e=c,!e.children.length&&CKEDITOR.dtd[e.name][d]&&(d=new CKEDITOR.htmlParser.element(d),e.add(d)));b.dataValue=c},null,null,5);a.on("toHtml",function(b){b.data.filter.applyTo(b.data.dataValue,!0,b.data.dontFilter,b.data.enterMode)&&a.fire("dataFiltered")},null,null,6);a.on("toHtml",function(a){a.data.dataValue.filterChildren(e.dataFilter,!0)},null,null,10);a.on("toHtml",function(a){a=a.data;var b=a.dataValue,
d=new CKEDITOR.htmlParser.basicWriter;b.writeChildrenHtml(d);b=d.getHtml(!0);a.dataValue=L(b)},null,null,15);a.on("toDataFormat",function(b){var c=b.data.dataValue;b.data.enterMode!=CKEDITOR.ENTER_BR&&(c=c.replace(/^<br *\/?>/i,""));b.data.dataValue=CKEDITOR.htmlParser.fragment.fromHtml(c,b.data.context,w(b.data.enterMode,a.config.autoParagraph))},null,null,5);a.on("toDataFormat",function(a){a.data.dataValue.filterChildren(e.htmlFilter,!0)},null,null,10);a.on("toDataFormat",function(a){a.data.filter.applyTo(a.data.dataValue,
!1,!0)},null,null,11);a.on("toDataFormat",function(b){var c=b.data.dataValue,d=e.writer;d.reset();c.writeChildrenHtml(d);c=d.getHtml(!0);c=l(c);c=B(c,a);b.data.dataValue=c},null,null,15)};CKEDITOR.htmlDataProcessor.prototype={toHtml:function(a,b,d,e){var f=this.editor,c,h,g,k;b&&"object"==typeof b?(c=b.context,d=b.fixForBody,e=b.dontFilter,h=b.filter,g=b.enterMode,k=b.protectedWhitespaces):c=b;c||null===c||(c=f.editable().getName());return f.fire("toHtml",{dataValue:a,context:c,fixForBody:d,dontFilter:e,
filter:h||f.filter,enterMode:g||f.enterMode,protectedWhitespaces:k}).dataValue},toDataFormat:function(a,b){var d,e,f;b&&(d=b.context,e=b.filter,f=b.enterMode);d||null===d||(d=this.editor.editable().getName());return this.editor.fire("toDataFormat",{dataValue:a,filter:e||this.editor.filter,context:d,enterMode:f||this.editor.enterMode}).dataValue}};var E=/(?:&nbsp;|\xa0)$/,A="{cke_protected}",p=CKEDITOR.dtd,D="caption colgroup col thead tfoot tbody".split(" "),u=CKEDITOR.tools.extend({},p.$blockLimit,
p.$block),N={elements:{input:x,textarea:x}},O={attributeNames:[[/^on/,"data-cke-pa-on"],[/^srcdoc/,"data-cke-pa-srcdoc"],[/^data-cke-expando$/,""]],elements:{iframe:function(a){if(a.attributes&&a.attributes.src){var b=a.attributes.src.toLowerCase().replace(/[^a-z]/gi,"");if(0===b.indexOf("javascript")||0===b.indexOf("data"))a.attributes["data-cke-pa-src"]=a.attributes.src,delete a.attributes.src}}}},P={elements:{embed:function(a){var b=a.parent;if(b&&"object"==b.name){var d=b.attributes.width,b=b.attributes.height;
d&&(a.attributes.width=d);b&&(a.attributes.height=b)}},a:function(a){var b=a.attributes;if(!(a.children.length||b.name||b.id||a.attributes["data-cke-saved-name"]))return!1}}},C={elementNames:[[/^cke:/,""],[/^\?xml:namespace$/,""]],attributeNames:[[/^data-cke-(saved|pa)-/,""],[/^data-cke-.*/,""],["hidefocus",""]],elements:{$:function(a){var b=a.attributes;if(b){if(b["data-cke-temp"])return!1;for(var d=["name","href","src"],e,f=0;f<d.length;f++)e="data-cke-saved-"+d[f],e in b&&delete b[d[f]]}return a},
table:function(a){a.children.slice(0).sort(function(a,d){var e,f;a.type==CKEDITOR.NODE_ELEMENT&&d.type==a.type&&(e=CKEDITOR.tools.indexOf(D,a.name),f=CKEDITOR.tools.indexOf(D,d.name));-1<e&&-1<f&&e!=f||(e=a.parent?a.getIndex():-1,f=d.parent?d.getIndex():-1);return e>f?1:-1})},param:function(a){a.children=[];a.isEmpty=!0;return a},span:function(a){"Apple-style-span"==a.attributes["class"]&&delete a.name},html:function(a){delete a.attributes.contenteditable;delete a.attributes["class"]},body:function(a){delete a.attributes.spellcheck;
delete a.attributes.contenteditable},style:function(a){var b=a.children[0];b&&b.value&&(b.value=CKEDITOR.tools.trim(b.value));a.attributes.type||(a.attributes.type="text/css")},title:function(a){var b=a.children[0];!b&&v(a,b=new CKEDITOR.htmlParser.text);b.value=a.attributes["data-cke-title"]||""},input:y,textarea:y},attributes:{"class":function(a){return CKEDITOR.tools.ltrim(a.replace(/(?:^|\s+)cke_[^\s]*/g,""))||!1}}};CKEDITOR.env.ie&&(C.attributes.style=function(a){return a.replace(/(^|;)([^\:]+)/g,
function(a){return a.toLowerCase()})});var G=/<(a|area|img|input|source)\b([^>]*)>/gi,H=/([\w-:]+)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,I=/^(href|src|name)$/i,R=/(?:<style(?=[ >])[^>]*>[\s\S]*?<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,Q=/(<textarea(?=[ >])[^>]*>)([\s\S]*?)(?:<\/textarea>)/gi,K=/<cke:encoded>([^<]*)<\/cke:encoded>/gi,S=/(<\/?)((?:object|embed|param|html|body|head|title)[^>]*>)/gi,U=/(<\/?)cke:((?:html|body|head|title)[^>]*>)/gi,T=/<cke:(param|embed)([^>]*?)\/?>(?!\s*<\/cke:\1)/gi})();